<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gamified Anki Flashcards</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Sample data with adaptive difficulty
    const sampleQuestions = {
      science: {
        beginner: [
          { q: "What process do plants use to make food?", a: "photosynthesis", type: "fillblank", difficulty: 1 },
          { q: "How many planets are in our solar system?", a: "eight", type: "fillblank", difficulty: 1 },
          { q: "What is the largest planet in our solar system?", a: "jupiter", type: "fillblank", difficulty: 1 }
        ],
        intermediate: [
          { q: "What gas do plants absorb during photosynthesis?", a: "carbon dioxide", type: "fillblank", difficulty: 2 },
          { q: "Which planet has the most moons?", a: "saturn", type: "fillblank", difficulty: 2 },
          { q: "What causes the greenhouse effect on Venus?", a: "thick atmosphere", type: "fillblank", difficulty: 2 }
        ],
        advanced: [
          { q: "Explain how chloroplasts convert light energy into chemical energy", a: "", type: "openended", difficulty: 3 },
          { q: "Describe the orbital mechanics that keep planets in stable paths", a: "", type: "openended", difficulty: 3 }
        ]
      },
      math: {
        beginner: [
          { q: "What is 15 × 8?", a: "120", type: "fillblank", difficulty: 1 },
          { q: "What is the square root of 64?", a: "8", type: "fillblank", difficulty: 1 },
          { q: "What is 144 ÷ 12?", a: "12", type: "fillblank", difficulty: 1 }
        ],
        intermediate: [
          { q: "What is 3.5 × 2.8?", a: "9.8", type: "fillblank", difficulty: 2 },
          { q: "Solve: 2x + 5 = 13", a: "x = 4", type: "fillblank", difficulty: 2 },
          { q: "What is 25% of 160?", a: "40", type: "fillblank", difficulty: 2 }
        ],
        advanced: [
          { q: "Calculate the area of a circle with radius 7cm", a: "153.94", type: "fillblank", difficulty: 3 },
          { q: "Solve the quadratic equation: x² + 5x + 6 = 0", a: "x = -2, -3", type: "fillblank", difficulty: 3 }
        ]
      },
      english: {
        beginner: [
          { q: "Write a short story about a magical forest", a: "", type: "openended", difficulty: 1 },
          { q: "Describe your favorite season in 3 sentences", a: "", type: "openended", difficulty: 1 }
        ],
        intermediate: [
          { q: "Write a persuasive essay about protecting the environment", a: "", type: "openended", difficulty: 2 },
          { q: "Create a character description with dialogue", a: "", type: "openended", difficulty: 2 }
        ],
        advanced: [
          { q: "Analyze the themes in a classic novel and compare them to modern issues", a: "", type: "openended", difficulty: 3 },
          { q: "Write a formal debate argument with supporting evidence", a: "", type: "openended", difficulty: 3 }
        ]
      }
    };

    const cardSeries = {
      "Solar System": {
        cards: [
          { name: "Sun", rarity: "legendary", unlocks: "Solar Energy Quest" },
          { name: "Mercury", rarity: "common", unlocks: null },
          { name: "Venus", rarity: "rare", unlocks: "Greenhouse Effect Quiz" },
          { name: "Earth", rarity: "legendary", unlocks: "Life Sciences Pack" },
          { name: "Mars", rarity: "rare", unlocks: "Mars Rover Adventure" },
          { name: "Jupiter", rarity: "legendary", unlocks: "Giant Planets Quest" },
          { name: "Saturn", rarity: "rare", unlocks: "Ring System Quiz" },
          { name: "Uranus", rarity: "common", unlocks: null },
          { name: "Neptune", rarity: "common", unlocks: null }
        ],
        questName: "Galaxy Explorer",
        questReward: "Astronaut Avatar Outfit"
      },
      "Ocean Life": {
        cards: [
          { name: "Whale", rarity: "legendary", unlocks: "Marine Biology Quest" },
          { name: "Dolphin", rarity: "rare", unlocks: "Communication Quiz" },
          { name: "Shark", rarity: "rare", unlocks: "Predator Pack" },
          { name: "Octopus", rarity: "legendary", unlocks: "Intelligence Tests" },
          { name: "Coral", rarity: "common", unlocks: null },
          { name: "Seahorse", rarity: "common", unlocks: null },
          { name: "Jellyfish", rarity: "rare", unlocks: "Bioluminescence Quiz" },
          { name: "Starfish", rarity: "common", unlocks: null }
        ],
        questName: "Ocean Explorer",
        questReward: "Marine Biologist Avatar"
      },
      "Dinosaurs": {
        cards: [
          { name: "T-Rex", rarity: "legendary", unlocks: "Carnivore Quest" },
          { name: "Triceratops", rarity: "rare", unlocks: "Herbivore Pack" },
          { name: "Stegosaurus", rarity: "rare", unlocks: "Defense Mechanisms Quiz" },
          { name: "Brontosaurus", rarity: "common", unlocks: null },
          { name: "Velociraptor", rarity: "legendary", unlocks: "Pack Hunter Adventure" },
          { name: "Pterodactyl", rarity: "rare", unlocks: "Flight Evolution Quiz" }
        ],
        questName: "Paleontologist",
        questReward: "Dinosaur Expert Avatar"
      }
    };

    // Avatar customization options
    const avatarOptions = {
      outfits: [
        { name: "Wizard Robes", cost: 50, unlocked: false, description: "Mystical learning powers!" },
        { name: "Astronaut Suit", cost: 100, unlocked: false, description: "Space exploration ready!" },
        { name: "Lab Coat", cost: 75, unlocked: false, description: "Perfect for science experiments!" },
        { name: "Adventure Gear", cost: 60, unlocked: false, description: "Ready for any quest!" }
      ],
      accessories: [
        { name: "Magic Wand", cost: 30, unlocked: false, description: "Cast learning spells!" },
        { name: "Telescope", cost: 40, unlocked: false, description: "Explore the cosmos!" },
        { name: "Microscope", cost: 35, unlocked: false, description: "Discover tiny worlds!" },
        { name: "Compass", cost: 25, unlocked: false, description: "Navigate knowledge!" }
      ],
      personalities: [
        { name: "Enthusiastic", cost: 0, unlocked: true, description: "Super excited about learning!" },
        { name: "Calm & Patient", cost: 20, unlocked: false, description: "Thoughtful and encouraging" },
        { name: "Funny & Playful", cost: 25, unlocked: false, description: "Makes learning fun!" },
        { name: "Wise Mentor", cost: 30, unlocked: false, description: "Deep wisdom and guidance" }
      ]
    };

    // Quest system
    const questSystem = {
      "Solar Energy Quest": {
        title: "Help Ender Power the Learning Station!",
        description: "The learning station is running low on power! Complete solar energy quizzes to help Ender harness the sun's energy.",
        requirements: ["Complete 3 science quizzes", "Score 80% or higher"],
        reward: { gems: 100, card: "Solar Panel", achievement: "Solar Scientist" },
        progress: { completed: 0, total: 3 }
      },
      "Galaxy Explorer": {
        title: "Journey Through the Solar System",
        description: "Join Ender on an epic space adventure! Collect all Solar System cards to unlock the galaxy.",
        requirements: ["Collect all Solar System cards"],
        reward: { gems: 200, outfit: "Astronaut Suit", achievement: "Galaxy Master" },
        progress: { completed: 0, total: 9 }
      }
    };

    // Speech settings and languages
    const speechSettings = {
      languages: [
        { code: 'en-US', name: 'English (US)', voice: 'friendly' },
        { code: 'en-GB', name: 'English (UK)', voice: 'polite' },
        { code: 'zh-CN', name: '中文 (Mandarin)', voice: 'gentle' },
        { code: 'zh-HK', name: '廣東話 (Cantonese)', voice: 'cheerful' },
        { code: 'es-ES', name: 'Español', voice: 'warm' },
        { code: 'fr-FR', name: 'Français', voice: 'elegant' }
      ],
      speeds: [
        { value: 0.7, label: 'Slow', description: 'Perfect for careful listening' },
        { value: 0.9, label: 'Normal', description: 'Standard speaking pace' },
        { value: 1.1, label: 'Fast', description: 'Quick and energetic' }
      ],
      tones: [
        { value: 0.8, label: 'Calm', description: 'Soothing and relaxed' },
        { value: 1.0, label: 'Normal', description: 'Natural tone' },
        { value: 1.2, label: 'Enthusiastic', description: 'Excited and motivating' }
      ]
    };

    const leaderboardData = [
      { name: "Alex", score: 2450, cards: 89, streak: 12, improvement: "+15%" },
      { name: "Maya", score: 2180, cards: 76, streak: 8, improvement: "+22%" },
      { name: "Sam", score: 1920, cards: 82, streak: 15, improvement: "+8%" },
      { name: "Zoe", score: 1875, cards: 71, streak: 5, improvement: "+31%" },
      { name: "Riley", score: 1654, cards: 68, streak: 9, improvement: "+18%" }
    };

    // Books for reading system
    const bookLibrary = [
      {
        id: 1,
        title: "The Magic Forest Adventure",
        author: "Luna Starwriter",
        chapters: [
          { title: "Chapter 1: The Mysterious Path", content: "Once upon a time, in a forest where the trees whispered secrets...", quiz: [{ q: "What did the trees do in the forest?", a: "whisper secrets" }] },
          { title: "Chapter 2: Meeting the Forest Guardian", content: "Deep in the forest, Maya encountered a glowing fairy...", quiz: [{ q: "Who did Maya meet in the forest?", a: "a glowing fairy" }] }
        ],
        difficulty: "beginner",
        subject: "english"
      },
      {
        id: 2,
        title: "Journey to the Stars",
        author: "Dr. Cosmos",
        chapters: [
          { title: "Chapter 1: Building a Rocket", content: "To reach the stars, we need to understand rocket science...", quiz: [{ q: "What do we need to understand to reach the stars?", a: "rocket science" }] },
          { title: "Chapter 2: The Launch", content: "With a thunderous roar, the rocket lifted off...", quiz: [{ q: "How did the rocket sound when it launched?", a: "thunderous roar" }] }
        ],
        difficulty: "intermediate",
        subject: "science"
      }
    ];

    // Main App Component
    const ANKIDApp = () => {
      // Core state
      const [currentScreen, setCurrentScreen] = useState('home');
      const [playerName, setPlayerName] = useState('Player');
      const [gems, setGems] = useState(150);
      const [totalScore, setTotalScore] = useState(1200);
      const [collectedCards, setCollectedCards] = useState([
        { name: 'Sun', rarity: 'legendary', series: 'Solar System' },
        { name: 'Earth', rarity: 'legendary', series: 'Solar System' },
        { name: 'Mars', rarity: 'rare', series: 'Solar System' },
        { name: 'Whale', rarity: 'legendary', series: 'Ocean Life' },
        { name: 'T-Rex', rarity: 'legendary', series: 'Dinosaurs' }
      ]);
      const [achievements, setAchievements] = useState(['Week Warrior', 'Card Collector']);
      const [streak, setStreak] = useState(7);
      const [playerLevel, setPlayerLevel] = useState(5);
      const [currentDifficulty, setCurrentDifficulty] = useState('beginner');
      
      // Avatar customization
      const [currentAvatar, setCurrentAvatar] = useState({
        outfit: 'default',
        accessory: 'none',
        personality: 'Enthusiastic'
      });
      const [unlockedItems, setUnlockedItems] = useState(['Enthusiastic']);
      
      // Speech settings
      const [speechPreferences, setSpeechPreferences] = useState({
        language: 'en-US',
        speed: 0.9,
        tone: 1.0,
        enabled: true
      });
      const [inputMode, setInputMode] = useState('speech'); // 'speech' or 'text'
      
      // Quiz state
      const [currentQuiz, setCurrentQuiz] = useState(null);
      const [currentQuestion, setCurrentQuestion] = useState(0);
      const [userAnswer, setUserAnswer] = useState('');
      const [feedback, setFeedback] = useState('');
      const [isListening, setIsListening] = useState(false);
      const [quizScore, setQuizScore] = useState(0);
      const [quizStreak, setQuizStreak] = useState(0);
      const [performanceHistory, setPerformanceHistory] = useState({});
      
      // AI Conversation state
      const [isTeaching, setIsTeaching] = useState(false);
      const [conversationHistory, setConversationHistory] = useState([]);
      const [currentTopic, setCurrentTopic] = useState('');
      const [teachingScore, setTeachingScore] = useState(0);
      
      // Card pack opening
      const [isOpeningPack, setIsOpeningPack] = useState(false);
      const [newCards, setNewCards] = useState([]);
      const [pitySystеm, setPitySystem] = useState(0); // Guaranteed rare after 5 packs
      
      // Reading state
      const [currentBook, setCurrentBook] = useState(null);
      const [currentChapter, setCurrentChapter] = useState(0);
      const [readingProgress, setReadingProgress] = useState({});
      
      // Quests and storyline
      const [activeQuests, setActiveQuests] = useState([]);
      const [completedQuests, setCompletedQuests] = useState([]);
      const [currentStoryline, setCurrentStoryline] = useState('Galaxy Explorer');
      
      // Team features
      const [playerTeam, setPlayerTeam] = useState(null);
      const [teamChallenges, setTeamChallenges] = useState([]);
      
      // Settings
      const [accessibilityMode, setAccessibilityMode] = useState(false);
      const [dyslexiaFriendly, setDyslexiaFriendly] = useState(false);
      const [reducedAnimations, setReducedAnimations] = useState(false);
      const [leaderboardType, setLeaderboardType] = useState('overall'); // 'overall', 'improvement', 'streak'

      // Enhanced speech functions with multilingual support
      const speak = (text, options = {}) => {
        if (!speechPreferences.enabled) return;
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = options.speed || speechPreferences.speed;
        utterance.pitch = options.tone || speechPreferences.tone;
        utterance.lang = options.language || speechPreferences.language;
        
        // Personality-based adjustments
        if (currentAvatar.personality === 'Enthusiastic') {
          utterance.pitch = Math.min(utterance.pitch * 1.1, 2.0);
          utterance.rate = Math.min(utterance.rate * 1.05, 2.0);
        } else if (currentAvatar.personality === 'Calm & Patient') {
          utterance.pitch = Math.max(utterance.pitch * 0.9, 0.5);
          utterance.rate = Math.max(utterance.rate * 0.85, 0.5);
        } else if (currentAvatar.personality === 'Funny & Playful') {
          utterance.pitch = utterance.pitch * (0.9 + Math.random() * 0.2);
        }
        
        window.speechSynthesis.speak(utterance);
      };

      const getPersonalityGreeting = () => {
        const greetings = {
          'Enthusiastic': [`Hi ${playerName}! I'm Ender and I'm SO excited to learn with you! ✨`, "Let's have an amazing learning adventure together!"],
          'Calm & Patient': [`Hello ${playerName}, I'm Ender. I'm here to help you learn at your own pace.`, "Take your time, I'll be here to guide you every step of the way."],
          'Funny & Playful': [`Hey there ${playerName}! I'm Ender, your funny learning buddy! 😄`, "Ready for some fun? Learning is like a game - let's play!"],
          'Wise Mentor': [`Greetings ${playerName}, I am Ender, your learning guide.`, "Knowledge is a treasure we'll discover together, young scholar."]
        };
        return greetings[currentAvatar.personality] || greetings['Enthusiastic'];
      };

      const listen = (callback = null) => {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
          alert('Speech recognition not supported in this browser');
          return;
        }
        
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = speechPreferences.language;
        
        setIsListening(true);
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          const confidence = event.results[0][0].confidence;
          
          setUserAnswer(transcript);
          setIsListening(false);
          
          // Handle different contexts
          if (currentQuiz) {
            checkAnswer(transcript, confidence);
          } else if (isTeaching) {
            handleTeachingResponse(transcript);
          } else if (callback) {
            callback(transcript);
          }
        };
        
        recognition.onerror = (event) => {
          setIsListening(false);
          if (event.error === 'no-speech') {
            speak("I didn't hear anything. Could you try speaking again?");
          } else if (event.error === 'audio-capture') {
            speak("I'm having trouble hearing you. Please check your microphone.");
          }
        };
        
        recognition.start();
      };

      // Adaptive difficulty system
      const getDifficultyLevel = (subject) => {
        const history = performanceHistory[subject] || { attempts: 0, averageScore: 0 };
        
        if (history.attempts < 3) return 'beginner';
        if (history.averageScore >= 90) return 'advanced';
        if (history.averageScore >= 70) return 'intermediate';
        return 'beginner';
      };

      const updatePerformanceHistory = (subject, score) => {
        setPerformanceHistory(prev => {
          const history = prev[subject] || { attempts: 0, totalScore: 0, averageScore: 0 };
          const newAttempts = history.attempts + 1;
          const newTotalScore = history.totalScore + score;
          const newAverageScore = newTotalScore / newAttempts;
          
          return {
            ...prev,
            [subject]: {
              attempts: newAttempts,
              totalScore: newTotalScore,
              averageScore: newAverageScore
            }
          };
        });
      };

      // Enhanced quiz functions with adaptive difficulty
      const startQuiz = (subject) => {
        const difficulty = getDifficultyLevel(subject);
        const questions = sampleQuestions[subject]?.[difficulty] || sampleQuestions[subject]?.beginner || [];
        
        if (questions.length > 0) {
          setCurrentQuiz({ subject, questions, difficulty });
          setCurrentQuestion(0);
          setQuizScore(0);
          setUserAnswer('');
          setFeedback('');
          setCurrentScreen('quiz');
          
          setTimeout(() => {
            const welcomeMsg = `Welcome to the ${subject} quiz! You're playing at ${difficulty} level.`;
            speak(welcomeMsg);
            setTimeout(() => {
              speak(questions[0].q);
            }, 2000);
          }, 500);
        }
      };

      const checkAnswer = (answer, confidence = 1.0) => {
        if (!currentQuiz) return;
        
        const question = currentQuiz.questions[currentQuestion];
        let isCorrect = false;
        let partialCredit = 0;
        
        if (question.type === 'fillblank') {
          isCorrect = answer.toLowerCase().includes(question.a.toLowerCase());
          if (!isCorrect && answer.toLowerCase().includes(question.a.toLowerCase().substring(0, 3))) {
            partialCredit = 0.5; // Partial credit for close answers
          }
        } else if (question.type === 'openended') {
          // Simple AI grading simulation
          const wordCount = answer.split(' ').length;
          const hasKeyTerms = question.a ? answer.toLowerCase().includes(question.a.toLowerCase()) : true;
          
          if (wordCount >= 10 && hasKeyTerms) {
            isCorrect = true;
          } else if (wordCount >= 5) {
            partialCredit = 0.7;
          } else {
            partialCredit = 0.3;
          }
        }
        
        let points = 0;
        let feedbackMsg = "";
        
        if (isCorrect) {
          points = 50 + Math.floor(Math.random() * 30) + (question.difficulty * 20);
          if (confidence > 0.8) points += 10; // Bonus for clear speech
          
          setQuizScore(prev => prev + points);
          setGems(prev => prev + Math.floor(points / 10));
          setQuizStreak(prev => prev + 1);
          
          feedbackMsg = `🎉 Excellent! You earned ${points} points!`;
          
          if (quizStreak >= 2) {
            feedbackMsg += ` ${quizStreak + 1} in a row - you're on fire! 🔥`;
            points += quizStreak * 5; // Streak bonus
          }
          
          const encouragement = getPersonalityEncouragement(true);
          speak(`${encouragement} You earned ${points} points!`);
          
        } else if (partialCredit > 0) {
          points = Math.floor((50 + Math.floor(Math.random() * 30)) * partialCredit);
          setQuizScore(prev => prev + points);
          setGems(prev => prev + Math.floor(points / 15));
          
          feedbackMsg = `⭐ Good effort! You got ${Math.floor(partialCredit * 100)}% credit and earned ${points} points!`;
          speak("Good try! You're getting close. Let me help you understand better.");
          
        } else {
          setQuizStreak(0);
          feedbackMsg = `❌ Not quite right. The answer is "${question.a}". Don't give up!`;
          
          const encouragement = getPersonalityEncouragement(false);
          speak(`${encouragement} The correct answer is ${question.a}. You'll get the next one!`);
        }
        
        setFeedback(feedbackMsg);
        
        setTimeout(() => {
          if (currentQuestion < currentQuiz.questions.length - 1) {
            setCurrentQuestion(prev => prev + 1);
            setUserAnswer('');
            setFeedback('');
            setTimeout(() => {
              speak(currentQuiz.questions[currentQuestion + 1].q);
            }, 1000);
          } else {
            completeQuiz();
          }
        }, 3000);
      };

      const getPersonalityEncouragement = (isCorrect) => {
        const personality = currentAvatar.personality;
        const correct = {
          'Enthusiastic': ["Amazing!", "Fantastic!", "You're incredible!", "Brilliant work!"],
          'Calm & Patient': ["Well done.", "Excellent work.", "Very good.", "Nice job."],
          'Funny & Playful': ["Awesome sauce!", "You rock!", "Super duper!", "Woohoo!"],
          'Wise Mentor': ["Excellent, young scholar.", "Your wisdom grows.", "Well reasoned.", "Impressive deduction."]
        };
        
        const incorrect = {
          'Enthusiastic': ["No worries!", "It's okay!", "Keep trying!", "You've got this!"],
          'Calm & Patient': ["That's alright.", "Take your time.", "Learning takes practice.", "Try again when ready."],
          'Funny & Playful': ["Oopsie!", "No biggie!", "Everyone makes mistakes!", "Try again, champ!"],
          'Wise Mentor': ["Mistakes are part of learning.", "Patience, young one.", "Consider this carefully.", "Reflect and try again."]
        };
        
        const responses = isCorrect ? correct[personality] : incorrect[personality];
        return responses[Math.floor(Math.random() * responses.length)];
      };

      const completeQuiz = () => {
        const subject = currentQuiz.subject;
        const finalScore = quizScore;
        const accuracy = (quizStreak / currentQuiz.questions.length) * 100;
        
        updatePerformanceHistory(subject, accuracy);
        setTotalScore(prev => prev + finalScore);
        
        const gemsEarned = Math.floor(finalScore / 25);
        setGems(prev => prev + gemsEarned);
        
        // Check for level up
        if (totalScore + finalScore > playerLevel * 500) {
          setPlayerLevel(prev => prev + 1);
          speak(`Congratulations! You've reached level ${playerLevel + 1}!`);
        }
        
        // Achievement checks
        checkAchievements(subject, accuracy, gemsEarned);
        
        speak(`Quiz completed! You scored ${finalScore} points with ${Math.round(accuracy)}% accuracy and earned ${gemsEarned} gems!`);
        
        setTimeout(() => {
          setCurrentScreen('home');
          setCurrentQuiz(null);
          setQuizStreak(0);
        }, 3000);
      };

      // Enhanced card functions with pity system and quest integration
      const openCardPack = () => {
        if (gems < 100) {
          speak("You need at least 100 gems to open a card pack!");
          return;
        }
        
        setGems(prev => prev - 100);
        setIsOpeningPack(true);
        
        setTimeout(() => {
          let newCard;
          let rarity;
          
          // Pity system - guarantee rare after 5 packs without rare
          if (pitySystеm >= 4) {
            // Guaranteed rare or legendary
            const rareCards = Object.values(cardSeries).flatMap(series => 
              series.cards.filter(card => card.rarity === 'rare' || card.rarity === 'legendary')
            );
            newCard = rareCards[Math.floor(Math.random() * rareCards.length)];
            rarity = newCard.rarity;
            setPitySystem(0);
          } else {
            // Normal randomization
            const random = Math.random();
            if (random < 0.1) rarity = 'legendary';
            else if (random < 0.4) rarity = 'rare';
            else rarity = 'common';
            
            const availableCards = Object.values(cardSeries).flatMap(series => 
              series.cards.filter(card => card.rarity === rarity)
            );
            newCard = availableCards[Math.floor(Math.random() * availableCards.length)];
            
            if (rarity === 'common') {
              setPitySystem(prev => prev + 1);
            } else {
              setPitySystem(0);
            }
          }
          
          setNewCards([newCard]);
          setCollectedCards(prev => [...prev, newCard]);
          setIsOpeningPack(false);
          
          const rarityEmoji = rarity === 'legendary' ? '💫' : rarity === 'rare' ? '⭐' : '✨';
          speak(`Congratulations! You got a ${rarity} ${newCard.name} card! ${rarityEmoji}`);
          
          // Check for quest completion
          checkQuestProgress(newCard);
          
          // Check for series completion
          checkSeriesCompletion(newCard);
          
        }, 2000);
      };

      const checkQuestProgress = (newCard) => {
        // Check if card unlocks special content
        if (newCard.unlocks) {
          speak(`Special unlock! Your ${newCard.name} card gives you access to ${newCard.unlocks}!`);
          // Add logic to unlock special quizzes or content
        }
        
        // Update quest progress for card collection quests
        Object.entries(cardSeries).forEach(([seriesName, series]) => {
          const collectedFromSeries = collectedCards.filter(card => card.series === seriesName).length;
          if (collectedFromSeries === series.cards.length && !completedQuests.includes(series.questName)) {
            completeQuest(series.questName, series.questReward);
          }
        });
      };

      const checkSeriesCompletion = (newCard) => {
        const series = Object.entries(cardSeries).find(([name, data]) => 
          data.cards.some(card => card.name === newCard.name)
        );
        
        if (series) {
          const [seriesName, seriesData] = series;
          const collectedFromSeries = collectedCards.filter(card => 
            seriesData.cards.some(seriesCard => seriesCard.name === card.name)
          );
          
          if (collectedFromSeries.length === seriesData.cards.length) {
            setAchievements(prev => [...prev, `${seriesName} Master`]);
            speak(`Amazing! You've completed the ${seriesName} collection! Achievement unlocked!`);
            
            // Award series completion bonus
            setGems(prev => prev + 200);
            if (seriesData.questReward) {
              unlockAvatarItem(seriesData.questReward);
            }
          }
        }
      };

      const completeQuest = (questName, reward) => {
        setCompletedQuests(prev => [...prev, questName]);
        setGems(prev => prev + reward.gems);
        
        if (reward.card) {
          setCollectedCards(prev => [...prev, { name: reward.card, rarity: 'legendary', series: 'Special' }]);
        }
        
        if (reward.outfit) {
          unlockAvatarItem(reward.outfit);
        }
        
        if (reward.achievement) {
          setAchievements(prev => [...prev, reward.achievement]);
        }
        
        speak(`Quest completed! ${questName} finished! You earned ${reward.gems} gems!`);
      };

      const unlockAvatarItem = (itemName) => {
        setUnlockedItems(prev => [...prev, itemName]);
        speak(`New avatar item unlocked: ${itemName}! Check your profile to equip it.`);
      };

      const checkAchievements = (subject, accuracy, gemsEarned) => {
        const newAchievements = [];
        
        // Perfect score achievement
        if (accuracy === 100 && !achievements.includes('Perfect Scholar')) {
          newAchievements.push('Perfect Scholar');
        }
        
        // Gem collector achievements
        if (gems > 500 && !achievements.includes('Gem Master')) {
          newAchievements.push('Gem Master');
        }
        
        // Subject mastery achievements
        const subjectMastery = `${subject.charAt(0).toUpperCase() + subject.slice(1)} Expert`;
        const history = performanceHistory[subject];
        if (history && history.attempts >= 5 && history.averageScore >= 85 && !achievements.includes(subjectMastery)) {
          newAchievements.push(subjectMastery);
        }
        
        // Streak achievements
        if (streak >= 14 && !achievements.includes('Two Week Warrior')) {
          newAchievements.push('Two Week Warrior');
        }
        
        if (newAchievements.length > 0) {
          setAchievements(prev => [...prev, ...newAchievements]);
          newAchievements.forEach(achievement => {
            speak(`Achievement unlocked: ${achievement}!`);
          });
        }
      };

      // Enhanced AI Teaching functions with dynamic conversation
      const startTeaching = (topic) => {
        setCurrentTopic(topic);
        setIsTeaching(true);
        setConversationHistory([]);
        setCurrentScreen('teaching');
        setTeachingScore(0);
        
        const greetings = getPersonalityGreeting();
        greetings.push(`I don't know much about ${topic}. Can you teach me about it?`);
        greetings.push("I'm really curious to learn! Please explain it to me in your own words.");
        
        setTimeout(() => {
          greetings.forEach((msg, index) => {
            setTimeout(() => {
              speak(msg);
              setConversationHistory(prev => [...prev, { speaker: 'Ender', message: msg, timestamp: Date.now() }]);
            }, index * 2500);
          });
        }, 500);
      };

      const handleTeachingResponse = (userResponse) => {
        // Add user response to conversation
        setConversationHistory(prev => [...prev, { 
          speaker: playerName, 
          message: userResponse, 
          timestamp: Date.now() 
        }]);
        
        // Simple AI response generation based on keywords and topic
        const response = generateAIResponse(userResponse, currentTopic);
        const points = Math.floor(userResponse.split(' ').length * 2) + Math.floor(Math.random() * 20);
        
        setTeachingScore(prev => prev + points);
        setGems(prev => prev + Math.floor(points / 5));
        
        setTimeout(() => {
          speak(response);
          setConversationHistory(prev => [...prev, { 
            speaker: 'Ender', 
            message: response, 
            timestamp: Date.now() 
          }]);
        }, 1500);
      };

      const generateAIResponse = (userInput, topic) => {
        const personality = currentAvatar.personality;
        const wordCount = userInput.split(' ').length;
        
        const responses = {
          'Enthusiastic': {
            good: ["That's amazing! Tell me more!", "Wow, that's so cool! What else?", "I love learning about this! Keep going!"],
            clarify: ["That's interesting! Can you explain more about that part?", "Ooh, I want to know more about that!", "That sounds important! Can you help me understand better?"],
            encourage: ["You're such a great teacher!", "I'm learning so much from you!", "You explain things so well!"]
          },
          'Calm & Patient': {
            good: ["Thank you for explaining that.", "I see. That's very helpful.", "That makes sense. Please continue."],
            clarify: ["Could you elaborate on that point?", "I'd like to understand that better.", "Can you provide more details?"],
            encourage: ["You're doing well.", "Thank you for your patience.", "Your explanation is clear."]
          },
          'Funny & Playful': {
            good: ["Haha, that's awesome!", "Cool beans! What's next?", "You rock at teaching!"],
            clarify: ["Hmm, can you break that down for my tiny brain?", "I'm a bit confused - help a fairy out?", "Ooh, that sounds fancy! Explain more!"],
            encourage: ["You're the best teacher ever!", "Learning is so fun with you!", "You make everything sound interesting!"]
          },
          'Wise Mentor': {
            good: ["Your knowledge is impressive.", "A wise observation indeed.", "You demonstrate good understanding."],
            clarify: ["Expand upon that concept, young scholar.", "Elaborate on that principle.", "What deeper meaning lies within?"],
            encourage: ["Your teaching skills grow stronger.", "Well explained, young master.", "You show the wisdom of a true educator."]
          }
        };
        
        const personalityResponses = responses[personality] || responses['Enthusiastic'];
        
        // Topic-specific follow-up questions
        const topicQuestions = {
          'Photosynthesis': ["What do plants need for photosynthesis?", "How do plants make oxygen?", "Why are plants green?"],
          'Solar System': ["Which planet is your favorite and why?", "How far is the sun from Earth?", "What makes planets stay in orbit?"],
          'Water Cycle': ["What happens to water when it evaporates?", "Where do clouds come from?", "Why does it rain?"],
          'Dinosaurs': ["What did dinosaurs eat?", "How do we know about dinosaurs?", "Why did dinosaurs become extinct?"],
          'Fractions': ["How do you add fractions?", "What's the difference between numerator and denominator?", "Can you give me an example?"],
          'Gravity': ["What makes things fall down?", "Does gravity work in space?", "How does gravity affect the planets?"]
        };
        
        if (wordCount > 15) {
          // Good detailed response
          const followUp = topicQuestions[topic] ? topicQuestions[topic][Math.floor(Math.random() * topicQuestions[topic].length)] : "";
          return `${personalityResponses.good[Math.floor(Math.random() * personalityResponses.good.length)]} ${followUp}`;
        } else if (wordCount > 5) {
          // Need more details
          return personalityResponses.clarify[Math.floor(Math.random() * personalityResponses.clarify.length)];
        } else {
          // Encourage more explanation
          return personalityResponses.encourage[Math.floor(Math.random() * personalityResponses.encourage.length)];
        }
      };

      // Reading system functions
      const startReading = (bookId) => {
        const book = bookLibrary.find(b => b.id === bookId);
        if (book) {
          setCurrentBook(book);
          setCurrentChapter(0);
          setCurrentScreen('reading');
          
          setTimeout(() => {
            speak(`Let's read "${book.title}" by ${book.author}. Chapter 1: ${book.chapters[0].title}`);
          }, 500);
        }
      };

      const readChapter = (chapterIndex) => {
        if (!currentBook || !currentBook.chapters[chapterIndex]) return;
        
        const chapter = currentBook.chapters[chapterIndex];
        setCurrentChapter(chapterIndex);
        
        // Update reading progress
        setReadingProgress(prev => ({
          ...prev,
          [currentBook.id]: Math.max(prev[currentBook.id] || 0, chapterIndex + 1)
        }));
        
        speak(`Chapter ${chapterIndex + 1}: ${chapter.title}`);
        setTimeout(() => {
          speak(chapter.content);
        }, 2000);
      };

      const completeChapter = () => {
        if (!currentBook) return;
        
        const chapter = currentBook.chapters[currentChapter];
        if (chapter.quiz && chapter.quiz.length > 0) {
          // Start chapter quiz
          setCurrentQuiz({
            subject: 'reading',
            questions: chapter.quiz,
            difficulty: currentBook.difficulty,
            bookTitle: currentBook.title,
            chapterTitle: chapter.title
          });
          setCurrentQuestion(0);
          setQuizScore(0);
          setUserAnswer('');
          setFeedback('');
          setCurrentScreen('quiz');
          
          setTimeout(() => {
            speak("Great reading! Now let's see how well you understood the chapter.");
            setTimeout(() => {
              speak(chapter.quiz[0].q);
            }, 1500);
          }, 500);
        } else {
          // Award reading completion points
          const points = 30 + Math.floor(Math.random() * 20);
          setTotalScore(prev => prev + points);
          setGems(prev => prev + Math.floor(points / 8));
          
          speak(`Great job reading! You earned ${points} points!`);
          
          // Check if book is completed
          if (currentChapter === currentBook.chapters.length - 1) {
            completeBook();
          }
        }
      };

      const completeBook = () => {
        if (!currentBook) return;
        
        const bookPoints = 100 + (currentBook.chapters.length * 20);
        setTotalScore(prev => prev + bookPoints);
        setGems(prev => prev + Math.floor(bookPoints / 5));
        
        setAchievements(prev => [...prev, `${currentBook.title} Reader`]);
        
        speak(`Congratulations! You've completed "${currentBook.title}"! You earned ${bookPoints} points and a special achievement!`);
        
        setTimeout(() => {
          setCurrentScreen('reading');
          setCurrentBook(null);
        }, 3000);
      };

      // Navigation Components
      const NavBar = () => (
        <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 shadow-lg">
          <div className="flex justify-between items-center max-w-6xl mx-auto">
            <div className="flex items-center space-x-4">
              <h1 className="text-2xl font-bold">🧚‍♀️ ANKID</h1>
              <span className="text-sm bg-white bg-opacity-20 px-2 py-1 rounded">
                Hi, {playerName}! 
              </span>
            </div>
            <div className="flex items-center space-x-6">
              <div className="flex items-center space-x-2">
                <span className="text-yellow-300">💎</span>
                <span className="font-bold">{gems}</span>
              </div>
              <div className="flex items-center space-x-2">
                <span>⭐</span>
                <span className="font-bold">{totalScore}</span>
              </div>
              <div className="flex items-center space-x-2">
                <span>🔥</span>
                <span className="font-bold">{streak} days</span>
              </div>
            </div>
          </div>
        </div>
      );

      const BottomNav = () => (
        <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2">
          <div className="flex justify-around max-w-md mx-auto">
            {[
              { id: 'home', icon: '🏠', label: 'Home' },
              { id: 'quizzes', icon: '📚', label: 'Learn' },
              { id: 'cards', icon: '🎴', label: 'Cards' },
              { id: 'leaderboard', icon: '🏆', label: 'Ranks' },
              { id: 'profile', icon: '👤', label: 'Profile' }
            ].map(item => (
              <button
                key={item.id}
                onClick={() => setCurrentScreen(item.id)}
                className={`flex flex-col items-center p-2 rounded-lg transition-colors ${
                  currentScreen === item.id 
                    ? 'bg-purple-100 text-purple-600' 
                    : 'text-gray-600 hover:text-purple-600'
                }`}
              >
                <span className="text-lg">{item.icon}</span>
                <span className="text-xs">{item.label}</span>
              </button>
            ))}
          </div>
        </div>
      );

      // Screen Components
      const HomeScreen = () => (
        <div className="p-6 max-w-4xl mx-auto space-y-6 pb-20">
          <div className="text-center mb-8">
            <h2 className="text-3xl font-bold text-gray-800 mb-2">Welcome back, {playerName}! 🌟</h2>
            <p className="text-gray-600">Ready for another learning adventure?</p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div 
              onClick={() => setCurrentScreen('quizzes')}
              className="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:scale-105 transform transition-all"
            >
              <div className="text-3xl mb-3">📚</div>
              <h3 className="text-xl font-bold mb-2">Start Learning</h3>
              <p className="text-blue-100">Take quizzes and earn gems!</p>
            </div>

            <div 
              onClick={() => setCurrentScreen('cards')}
              className="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:scale-105 transform transition-all"
            >
              <div className="text-3xl mb-3">🎴</div>
              <h3 className="text-xl font-bold mb-2">Collect Cards</h3>
              <p className="text-purple-100">Open packs and trade cards!</p>
            </div>

            <div 
              onClick={() => setCurrentScreen('teaching')}
              className="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:scale-105 transform transition-all"
            >
              <div className="text-3xl mb-3">🧚‍♀️</div>
              <h3 className="text-xl font-bold mb-2">Teach Ender</h3>
              <p className="text-green-100">Explain topics to your AI friend!</p>
            </div>

            <div 
              onClick={() => setCurrentScreen('reading')}
              className="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:scale-105 transform transition-all"
            >
              <div className="text-3xl mb-3">📖</div>
              <h3 className="text-xl font-bold mb-2">Read Stories</h3>
              <p className="text-orange-100">Chapter by chapter adventures!</p>
            </div>

            <div 
              onClick={() => setCurrentScreen('leaderboard')}
              className="bg-gradient-to-br from-yellow-500 to-yellow-600 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:scale-105 transform transition-all"
            >
              <div className="text-3xl mb-3">🏆</div>
              <h3 className="text-xl font-bold mb-2">Leaderboard</h3>
              <p className="text-yellow-100">See who's leading!</p>
            </div>

            <div 
              onClick={openCardPack}
              className="bg-gradient-to-br from-pink-500 to-pink-600 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:scale-105 transform transition-all"
            >
              <div className="text-3xl mb-3">🎁</div>
              <h3 className="text-xl font-bold mb-2">Open Pack</h3>
              <p className="text-pink-100">100 gems for a surprise!</p>
            </div>
          </div>

          {isOpeningPack && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
              <div className="bg-white p-8 rounded-xl text-center">
                <div className="text-6xl mb-4 animate-spin">🎁</div>
                <p className="text-xl font-bold">Opening your card pack...</p>
              </div>
            </div>
          )}

          {newCards.length > 0 && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
              <div className="bg-white p-8 rounded-xl text-center max-w-sm">
                <h3 className="text-2xl font-bold mb-4">New Card! 🎉</h3>
                <div className="bg-gradient-to-br from-purple-400 to-purple-600 text-white p-6 rounded-lg mb-4">
                  <div className="text-3xl mb-2">⭐</div>
                  <h4 className="text-xl font-bold">{newCards[0]}</h4>
                </div>
                <button 
                  onClick={() => setNewCards([])}
                  className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700"
                >
                  Awesome!
                </button>
              </div>
            </div>
          )}
        </div>
      );

      const QuizScreen = () => (
        <div className="p-6 max-w-2xl mx-auto pb-20">
          <h2 className="text-2xl font-bold text-center mb-8">Choose Your Subject 📚</h2>
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {Object.keys(sampleQuestions).map(subject => (
              <div
                key={subject}
                onClick={() => startQuiz(subject)}
                className="bg-white p-6 rounded-xl shadow-lg border-2 border-gray-200 hover:border-purple-400 cursor-pointer hover:scale-105 transform transition-all"
              >
                <div className="text-center">
                  <div className="text-4xl mb-3">
                    {subject === 'science' ? '🔬' : subject === 'math' ? '🔢' : '📝'}
                  </div>
                  <h3 className="text-xl font-bold capitalize mb-2">{subject}</h3>
                  <p className="text-gray-600">
                    {sampleQuestions[subject].length} questions available
                  </p>
                </div>
              </div>
            ))}
          </div>
        </div>
      );

      const QuizPlayScreen = () => {
        if (!currentQuiz) return null;
        
        const question = currentQuiz.questions[currentQuestion];
        const progress = ((currentQuestion + 1) / currentQuiz.questions.length) * 100;
        
        return (
          <div className="p-6 max-w-2xl mx-auto pb-20">
            <div className="mb-6">
              <div className="flex justify-between items-center mb-2">
                <span className="text-sm text-gray-600">
                  Question {currentQuestion + 1} of {currentQuiz.questions.length}
                </span>
                <span className="text-sm text-purple-600 font-bold">
                  Score: {quizScore}
                </span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div 
                  className="bg-purple-600 h-2 rounded-full transition-all duration-300"
                  style={{ width: `${progress}%` }}
                ></div>
              </div>
            </div>

            <div className="bg-white rounded-xl shadow-lg p-8 text-center">
              <div className="text-5xl mb-6">🧚‍♀️</div>
              <h3 className="text-xl font-bold mb-6">{question.q}</h3>
              
              <div className="space-y-4">
                <input
                  type="text"
                  value={userAnswer}
                  onChange={(e) => setUserAnswer(e.target.value)}
                  placeholder="Type your answer or use speech..."
                  className="w-full p-4 border-2 border-gray-300 rounded-lg text-center text-lg focus:border-purple-500 focus:outline-none"
                />
                
                <div className="flex justify-center space-x-4">
                  <button
                    onClick={listen}
                    disabled={isListening}
                    className={`px-6 py-3 rounded-lg font-bold text-white transition-all ${
                      isListening 
                        ? 'bg-red-500 animate-pulse' 
                        : 'bg-blue-500 hover:bg-blue-600'
                    }`}
                  >
                    {isListening ? '🎤 Listening...' : '🎤 Speak Answer'}
                  </button>
                  
                  <button
                    onClick={() => checkAnswer(userAnswer)}
                    disabled={!userAnswer.trim()}
                    className="px-6 py-3 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 disabled:bg-gray-400 transition-all"
                  >
                    Submit ✨
                  </button>
                </div>
              </div>

              {feedback && (
                <div className="mt-6 p-4 bg-gray-100 rounded-lg">
                  <p className="text-lg">{feedback}</p>
                </div>
              )}
            </div>
          </div>
        );
      };

      const CardsScreen = () => (
        <div className="p-6 max-w-4xl mx-auto pb-20">
          <div className="text-center mb-8">
            <h2 className="text-2xl font-bold mb-2">Your Card Collection 🎴</h2>
            <p className="text-gray-600">Collected: {collectedCards.length} cards</p>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">
            {collectedCards.map((card, index) => (
              <div key={index} className="bg-gradient-to-br from-purple-400 to-purple-600 text-white p-4 rounded-lg shadow-lg text-center">
                <div className="text-2xl mb-2">⭐</div>
                <h4 className="font-bold">{card}</h4>
                <p className="text-xs text-purple-100">Rare</p>
              </div>
            ))}
          </div>

          <div className="text-center">
            <button
              onClick={openCardPack}
              disabled={gems < 100}
              className="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:scale-105 transform transition-all disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Open Card Pack (100 💎)
            </button>
            {gems < 100 && (
              <p className="text-gray-500 mt-2">Need more gems! Complete quizzes to earn them.</p>
            )}
          </div>
        </div>
      );

      const TeachingScreen = () => (
        <div className="p-6 max-w-2xl mx-auto pb-20">
          <div className="text-center mb-8">
            <h2 className="text-2xl font-bold mb-2">Teach Ender! 🧚‍♀️</h2>
            <p className="text-gray-600">Choose a topic to explain to your AI friend</p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {['Photosynthesis', 'Solar System', 'Water Cycle', 'Dinosaurs', 'Fractions', 'Gravity'].map(topic => (
              <button
                key={topic}
                onClick={() => startTeaching(topic)}
                className="bg-white p-4 rounded-lg shadow-lg border-2 border-gray-200 hover:border-green-400 hover:scale-105 transform transition-all"
              >
                <h3 className="font-bold text-lg">{topic}</h3>
                <p className="text-green-600 text-sm">Teach Ender about this!</p>
              </button>
            ))}
          </div>

          {conversationHistory.length > 0 && (
            <div className="mt-8 bg-white rounded-xl shadow-lg p-6">
              <h3 className="font-bold mb-4">Conversation with Ender:</h3>
              <div className="space-y-4 max-h-64 overflow-y-auto">
                {conversationHistory.map((msg, index) => (
                  <div key={index} className={`p-3 rounded-lg ${
                    msg.speaker === 'Ender' ? 'bg-purple-100' : 'bg-blue-100'
                  }`}>
                    <span className="font-bold">{msg.speaker}: </span>
                    {msg.message}
                  </div>
                ))}
              </div>
              
              <div className="mt-4 flex space-x-2">
                <button
                  onClick={listen}
                  className="flex-1 bg-green-500 text-white p-3 rounded-lg font-bold hover:bg-green-600"
                >
                  🎤 Speak to Ender
                </button>
              </div>
            </div>
          )}
        </div>
      );

      const LeaderboardScreen = () => (
        <div className="p-6 max-w-2xl mx-auto pb-20">
          <h2 className="text-2xl font-bold text-center mb-8">Leaderboard 🏆</h2>
          
          <div className="bg-white rounded-xl shadow-lg overflow-hidden">
            {leaderboardData.map((player, index) => (
              <div key={index} className={`p-4 border-b border-gray-200 flex items-center justify-between ${
                index < 3 ? 'bg-gradient-to-r from-yellow-50 to-yellow-100' : ''
              }`}>
                <div className="flex items-center space-x-4">
                  <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-white ${
                    index === 0 ? 'bg-yellow-500' : 
                    index === 1 ? 'bg-gray-400' : 
                    index === 2 ? 'bg-orange-500' : 'bg-purple-500'
                  }`}>
                    {index + 1}
                  </div>
                  <div>
                    <h3 className="font-bold">{player.name}</h3>
                    <p className="text-gray-600 text-sm">{player.cards} cards collected</p>
                  </div>
                </div>
                <div className="text-right">
                  <p className="font-bold text-lg">{player.score}</p>
                  <p className="text-gray-600 text-sm">points</p>
                </div>
              </div>
            ))}
          </div>
          
          <div className="mt-6 text-center">
            <p className="text-gray-600">Your current rank: #6 with {totalScore} points</p>
          </div>
        </div>
      );

      const ProfileScreen = () => (
        <div className="p-6 max-w-2xl mx-auto pb-20">
          <div className="text-center mb-8">
            <div className="w-24 h-24 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full mx-auto mb-4 flex items-center justify-center text-4xl text-white">
              👤
            </div>
            <h2 className="text-2xl font-bold">{playerName}</h2>
            <p className="text-gray-600">Learning Champion</p>
          </div>

          <div className="grid grid-cols-2 gap-4 mb-8">
            <div className="bg-white p-4 rounded-lg shadow text-center">
              <div className="text-2xl font-bold text-purple-600">{totalScore}</div>
              <div className="text-gray-600">Total Score</div>
            </div>
            <div className="bg-white p-4 rounded-lg shadow text-center">
              <div className="text-2xl font-bold text-yellow-600">{gems}</div>
              <div className="text-gray-600">Gems</div>
            </div>
            <div className="bg-white p-4 rounded-lg shadow text-center">
              <div className="text-2xl font-bold text-green-600">{collectedCards.length}</div>
              <div className="text-gray-600">Cards</div>
            </div>
            <div className="bg-white p-4 rounded-lg shadow text-center">
              <div className="text-2xl font-bold text-red-600">{streak}</div>
              <div className="text-gray-600">Day Streak</div>
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="font-bold text-lg mb-4">Achievements 🏆</h3>
            <div className="space-y-3">
              <div className="flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg">
                <span className="text-2xl">🔥</span>
                <div>
                  <h4 className="font-bold">Week Warrior</h4>
                  <p className="text-gray-600 text-sm">7-day learning streak!</p>
                </div>
              </div>
              <div className="flex items-center space-x-3 p-3 bg-purple-50 rounded-lg">
                <span className="text-2xl">🎴</span>
                <div>
                  <h4 className="font-bold">Card Collector</h4>
                  <p className="text-gray-600 text-sm">Collected 5+ cards</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      );

      // Main render
      return (
        <div className="min-h-screen bg-gray-50">
          <NavBar />
          
          {currentScreen === 'home' && <HomeScreen />}
          {currentScreen === 'quizzes' && <QuizScreen />}
          {currentScreen === 'quiz' && <QuizPlayScreen />}
          {currentScreen === 'cards' && <CardsScreen />}
          {currentScreen === 'teaching' && <TeachingScreen />}
          {currentScreen === 'leaderboard' && <LeaderboardScreen />}
          {currentScreen === 'profile' && <ProfileScreen />}
          
          <BottomNav />
        </div>
      );
    };

    ReactDOM.render(<ANKIDApp />, document.getElementById("root"));
  </script>
</body>
</html>