<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ANKID - Advanced Gamified Learning Platform</title>
  
  <!-- Multiple CDN fallbacks -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script>
    if (typeof React === 'undefined') {
      document.write('<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"><\/script>');
    }
  </script>
  
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script>
    if (typeof ReactDOM === 'undefined') {
      document.write('<script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"><\/script>');
    }
  </script>
  
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script>
    if (typeof Babel === 'undefined') {
      document.write('<script src="https://cdn.jsdelivr.net/npm/babel-standalone@6/babel.min.js"><\/script>');
    }
  </script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&family=SF+Pro+Text:wght@300;400;500;600&display=swap');
    
    :root {
      --gn-primary: #007AFF;
      --gn-secondary: #34C759;
      --gn-orange: #FF9500;
      --gn-red: #FF3B30;
      --gn-purple: #AF52DE;
      --gn-pink: #FF2D92;
      --gn-yellow: #FFCC02;
      --gn-teal: #32D74B;
      
      --gn-gray-1: #F2F2F7;
      --gn-gray-2: #E5E5EA;
      --gn-gray-3: #D1D1D6;
      --gn-gray-4: #C7C7CC;
      --gn-gray-5: #AEAEB2;
      --gn-gray-6: #8E8E93;
      
      --gn-text-primary: #1D1D1F;
      --gn-text-secondary: #86868B;
      --gn-text-tertiary: #AEAEB2;
      
      --gn-background: #FAFAFA;
      --gn-surface: #FFFFFF;
      --gn-paper: #FEFEFE;
      
      --gn-shadow-light: rgba(0, 0, 0, 0.04);
      --gn-shadow-medium: rgba(0, 0, 0, 0.08);
      --gn-shadow-strong: rgba(0, 0, 0, 0.12);
      
      --gn-border-light: rgba(0, 0, 0, 0.05);
      --gn-border-medium: rgba(0, 0, 0, 0.08);
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--gn-background);
      color: var(--gn-text-primary);
      line-height: 1.47;
      font-size: 17px;
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      font-weight: 600;
      line-height: 1.2;
      margin: 0;
    }
    
    .gn-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .gn-header {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--gn-border-light);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .gn-paper {
      background: var(--gn-surface);
      border-radius: 12px;
      border: 1px solid var(--gn-border-light);
      box-shadow: 
        0 1px 3px var(--gn-shadow-light),
        0 4px 12px var(--gn-shadow-medium);
      position: relative;
      overflow: hidden;
    }
    
    .gn-paper::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        linear-gradient(90deg, transparent 31px, var(--gn-border-light) 31px, var(--gn-border-light) 32px, transparent 32px),
        repeating-linear-gradient(transparent, transparent 23px, var(--gn-border-light) 23px, var(--gn-border-light) 24px);
      pointer-events: none;
      opacity: 0.6;
      z-index: 1;
    }
    
    .gn-paper-content {
      position: relative;
      z-index: 2;
      background: rgba(255, 255, 255, 0.95);
    }
    
    .gn-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 20px;
      background: var(--gn-primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-family: 'SF Pro Text', system-ui, sans-serif;
      font-size: 17px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      text-decoration: none;
      min-height: 44px;
    }
    
    .gn-button:hover {
      background: #0056CC;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.25);
    }
    
    .gn-button:active {
      transform: translateY(0);
    }
    
    .gn-button-secondary {
      background: var(--gn-gray-1);
      color: var(--gn-text-primary);
      border: 1px solid var(--gn-border-medium);
    }
    
    .gn-button-secondary:hover {
      background: var(--gn-gray-2);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px var(--gn-shadow-medium);
    }
    
    .gn-input {
      width: 100%;
      padding: 16px 20px;
      background: var(--gn-surface);
      border: 1px solid var(--gn-border-medium);
      border-radius: 10px;
      font-family: 'SF Pro Text', system-ui, sans-serif;
      font-size: 17px;
      color: var(--gn-text-primary);
      transition: all 0.15s ease;
    }
    
    .gn-input:focus {
      outline: none;
      border-color: var(--gn-primary);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }
    
    .gn-nav-tab {
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
      font-size: 15px;
      text-decoration: none;
      color: var(--gn-text-secondary);
      transition: all 0.15s ease;
    }
    
    .gn-nav-tab.active {
      color: var(--gn-primary);
      background: rgba(0, 122, 255, 0.1);
    }
    
    .gn-nav-tab:hover {
      color: var(--gn-text-primary);
      background: var(--gn-gray-1);
    }
    
    .gn-card {
      background: var(--gn-surface);
      border-radius: 16px;
      border: 1px solid var(--gn-border-light);
      box-shadow: 0 2px 10px var(--gn-shadow-light);
      transition: all 0.2s ease;
      overflow: hidden;
    }
    
    .gn-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--gn-shadow-medium);
      border-color: var(--gn-border-medium);
    }
    
    .gn-icon-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: var(--gn-gray-1);
      border: 1px solid var(--gn-border-light);
      color: var(--gn-text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .gn-icon-button:hover {
      background: var(--gn-gray-2);
      color: var(--gn-text-primary);
      transform: translateY(-1px);
    }
    
    .gn-stats-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      position: relative;
    }
    
    .gn-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      background: var(--gn-gray-1);
      color: var(--gn-text-secondary);
      border-radius: 12px;
      font-size: 13px;
      font-weight: 500;
    }
    
    .gn-floating-panel {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--gn-surface);
      border-radius: 20px;
      border: 1px solid var(--gn-border-light);
      box-shadow: 
        0 4px 20px var(--gn-shadow-medium),
        0 10px 40px var(--gn-shadow-strong);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      overflow: hidden;
      z-index: 200;
    }
    
    .gn-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .gn-modal {
      background: var(--gn-surface);
      border-radius: 16px;
      border: 1px solid var(--gn-border-light);
      box-shadow: 0 20px 60px var(--gn-shadow-strong);
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow: hidden;
    }
    
    .gn-section-title {
      font-size: 22px;
      font-weight: 600;
      color: var(--gn-text-primary);
      margin-bottom: 8px;
    }
    
    .gn-section-subtitle {
      font-size: 15px;
      color: var(--gn-text-secondary);
      margin-bottom: 24px;
    }
    
    .gn-divider {
      height: 1px;
      background: var(--gn-border-light);
      margin: 24px 0;
    }
    
    .gn-question-bubble {
      background: var(--gn-gray-1);
      border-radius: 16px;
      padding: 24px;
      margin: 24px 0;
      border-left: 4px solid var(--gn-primary);
      position: relative;
    }
    
    .gn-feedback-success {
      background: rgba(52, 199, 89, 0.1);
      border-color: var(--gn-secondary);
      color: #1F8B4C;
    }
    
    .gn-feedback-error {
      background: rgba(255, 59, 48, 0.1);
      border-color: var(--gn-red);
      color: #C4314B;
    }
    
    .avatar-float {
      animation: gentleFloat 4s ease-in-out infinite;
    }
    
    @keyframes gentleFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-4px); }
    }
    
    .card-appear {
      animation: cardAppear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    @keyframes cardAppear {
      0% {
        opacity: 0;
        transform: scale(0.8) translateY(20px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    
    .dyslexia-font {
      font-family: 'OpenDyslexic', 'Comic Sans MS', cursive !important;
    }
    
    .high-contrast {
      --gn-background: #000000;
      --gn-surface: #1C1C1E;
      --gn-text-primary: #FFFFFF;
      --gn-text-secondary: #E5E5EA;
    }
    
    .reduced-motion * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.1s !important;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .gn-container {
        padding: 0 16px;
      }
      
      .gn-stats-circle {
        width: 48px;
        height: 48px;
      }
      
      .gn-floating-panel {
        bottom: 16px;
        right: 16px;
      }
    }
  </style>
</head>
<body>
  <div id="root">
    <!-- GoodNotes 6 Style App -->
    <div class="min-h-screen bg-gray-50">
      <!-- Header -->
      <div class="gn-header">
        <div class="gn-container">
          <div class="flex items-center justify-between py-4">
            <div class="flex items-center space-x-6">
              <h1 style="font-size: 28px; font-weight: 700; color: var(--gn-text-primary); margin: 0;">
                ANKID
              </h1>
              <div class="gn-badge" style="background: linear-gradient(135deg, var(--gn-orange) 0%, var(--gn-pink) 100%); color: white;">
                Gamified Learning Adventure
              </div>
            </div>
            
            <div class="flex items-center space-x-3">
              <button onclick="toggleSpeech()" class="gn-icon-button">
                <Icon name="mic" />
              </button>
              <button onclick="showSettings()" class="gn-icon-button">
                <Icon name="settings" />
              </button>
            </div>
          </div>
          
          <!-- Navigation -->
          <div className="flex space-x-2 pb-4">
            <button onClick={() => showSection('dashboard')} className={`gn-nav-tab ${currentSection === 'dashboard' ? 'active' : ''}`}>Dashboard</button>
            <button onClick={() => showSection('study')} className={`gn-nav-tab ${currentSection === 'study' ? 'active' : ''}`}>Study</button>
            <button onClick={() => showSection('collection')} className={`gn-nav-tab ${currentSection === 'collection' ? 'active' : ''}`}>Collection</button>
            <button onClick={() => showSection('quests')} className={`gn-nav-tab ${currentSection === 'quests' ? 'active' : ''}`}>Quests</button>
            <button onClick={() => showSection('leaderboard')} className={`gn-nav-tab ${currentSection === 'leaderboard' ? 'active' : ''}`}>Leaderboard</button>
            <button onClick={() => showSection('avatar')} className={`gn-nav-tab ${currentSection === 'avatar' ? 'active' : ''}`}>Avatar</button>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div className="gn-container py-8">
        {renderCurrentSection()}
      </div>
    </div>
  </div>
  
  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // Simple SVG Icon Component (GoodNotes 6 style)
    const Icon = ({ name, size = 24, color = "currentColor", className = "" }) => {
      const icons = {
        // Navigation & Interface
        'settings': <path strokeLinecap="round" strokeLinejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z M15 12a3 3 0 11-6 0 3 3 0 016 0z" />,
        'swords': <g><path strokeLinecap="round" strokeLinejoin="round" d="M3 3l18 18M9 9l6 6m-6-6L3 3m6 6v6a2 2 0 002 2h2a2 2 0 002-2v-6m-6-6h6l6-6"/></g>,
        'gem': <path strokeLinecap="round" strokeLinejoin="round" d="M5 12l5-8 5 8-5 8-5-8z M5 12h14 M10 4l2 8 2-8"/>,
        'layers': <g><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></g>,
        'flame': <path strokeLinecap="round" strokeLinejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z"/>,
        'graduation-cap': <path strokeLinecap="round" strokeLinejoin="round" d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0112 13.489a50.702 50.702 0 017.74-3.342M6.75 15a.75.75 0 100-1.5.75.75 0 000 1.5zm0 0v-3.675A55.378 55.378 0 0112 8.443m-7.007 11.55A5.981 5.981 0 006.75 15.75v-1.5"/>,
        
        // Subject Icons
        'calculator': <g><rect x="4" y="2" width="16" height="20" rx="2"/><path d="M8 6h8M8 10h8M8 14h2M14 14h2M8 18h8"/></g>,
        'flask-conical': <path strokeLinecap="round" strokeLinejoin="round" d="M9 3h6v6l4 8H5l4-8V3z"/>,
        'book-open': <path strokeLinecap="round" strokeLinejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25A8.966 8.966 0 0118 3.75c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/>,
        
        // Avatar Icons
        'sparkles': <g><path d="M9.937 15.5A2 2 0 008.5 14.063l-6.135-1.582a.5.5 0 010-.962L8.5 9.936A2 2 0 009.937 8.5l1.582-6.135a.5.5 0 01.962 0L14.063 8.5A2 2 0 0015.5 9.937l6.135 1.582a.5.5 0 010 .962L15.5 14.063a2 2 0 00-1.437 1.437l-1.582 6.135a.5.5 0 01-.962 0L9.937 15.5z"/></g>,
        'bot': <g><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></g>,
        'zap': <path strokeLinecap="round" strokeLinejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>,
        
        // Action Icons
        'trophy': <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.228V2.721m-2.48 5.228a6.726 6.726 0 01-2.748 1.35m0 0A6.772 6.772 0 0112 10.5c-.665 0-1.312-.098-1.922-.272m0 0A6.772 6.772 0 007.228 8.47m0 0A6.547 6.547 0 006 5.227m0 0a6.721 6.721 0 016-2.477c2.247 0 4.312.857 5.86 2.263m0 0A6.547 6.547 0 0118 5.227"/>,
        'mic': <path strokeLinecap="round" strokeLinejoin="round" d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3zM19 10v2a7 7 0 01-14 0v-2M12 19v4M8 23h8"/>,
        'keyboard': <rect x="2" y="4" width="20" height="16" rx="2"/>,
        'lightbulb': <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0zm-4 5.5V20a2 2 0 01-4 0v-2.5"/>,
        'send': <path strokeLinecap="round" strokeLinejoin="round" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>,
        'check-circle': <path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>,
        'x-circle': <path strokeLinecap="round" strokeLinejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>,
        'arrow-left': <path strokeLinecap="round" strokeLinejoin="round" d="M19 12H5m7 7l-7-7 7-7"/>,
        'play': <path strokeLinecap="round" strokeLinejoin="round" d="M5 3l14 9-14 9V3z"/>,
        'star': <path strokeLinecap="round" strokeLinejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>,
        'heart': <path strokeLinecap="round" strokeLinejoin="round" d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>,
        'plus': <path strokeLinecap="round" strokeLinejoin="round" d="M12 5v14m-7-7h14"/>,
        'edit': <path strokeLinecap="round" strokeLinejoin="round" d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7m-8-2l4-4m0 0l3-3m-3 3l-3 3"/>,
        'trash': <path strokeLinecap="round" strokeLinejoin="round" d="M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>,
        'refresh': <path strokeLinecap="round" strokeLinejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>,
        'home': <path strokeLinecap="round" strokeLinejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>,
        'gift': <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v17.25m0 0c-1.472 0-2.882.265-4.185.75M12 20.25c1.472 0 2.882.265 4.185.75M18.75 4.97A48.416 48.416 0 0012 4C7.689 4 4.39 4.588 2.25 5.688m16.5-.717C16.402 4.402 14.205 4 12 4c-1.618 0-3.203.202-4.75.571m16.5.396c.538 2.197.538 4.507 0 6.704m0 0c-.348 1.423-.873 2.783-1.563 4.063C21.295 17.037 18.977 18.75 16.313 19.688"/>,
        'users': <path strokeLinecap="round" strokeLinejoin="round" d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
      };
      
      const iconPath = icons[name];
      if (!iconPath) return null;
      
      return (
        <svg
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke={color}
          strokeWidth="2"
          className={`gn-icon ${className}`}
          xmlns="http://www.w3.org/2000/svg"
        >
          {iconPath}
        </svg>
      );
    };

    // Main ANKID App Component
    const ANKIDApp = () => {
      const [currentSection, setCurrentSection] = useState('dashboard');
      const [userStats, setUserStats] = useState({
        level: 1,
        xp: 0,
        xpToNext: 100,
        streak: 0,
        totalCards: 0,
        masteredCards: 0,
        gems: 0
      });
      
      const [flashcards, setFlashcards] = useState([]);
      const [isStudying, setIsStudying] = useState(false);
      const [currentCard, setCurrentCard] = useState(null);
      const [showAnswer, setShowAnswer] = useState(false);
      const [userAvatar, setUserAvatar] = useState({
        head: 'human',
        body: 'casual',
        accessory: 'none',
        background: 'forest'
      });
      
      const [quests, setQuests] = useState([
        { id: 1, title: 'First Steps', description: 'Create your first flashcard', reward: 50, completed: false, type: 'create' },
        { id: 2, title: 'Knowledge Seeker', description: 'Study 5 flashcards', reward: 100, completed: false, type: 'study', progress: 0, target: 5 },
        { id: 3, title: 'Streak Master', description: 'Maintain a 3-day study streak', reward: 200, completed: false, type: 'streak', progress: 0, target: 3 }
      ]);
      
      const [leaderboard, setLeaderboard] = useState([
        { rank: 1, name: 'Scholar Supreme', xp: 2500, level: 12, streak: 15 },
        { rank: 2, name: 'Study Ninja', xp: 2200, level: 11, streak: 12 },
        { rank: 3, name: 'Memory Master', xp: 1800, level: 9, streak: 8 },
        { rank: 4, name: 'You', xp: userStats.xp, level: userStats.level, streak: userStats.streak }
      ]);

      const showSection = (section) => {
        setCurrentSection(section);
      };

      const addXP = (amount) => {
        setUserStats(prev => {
          const newXP = prev.xp + amount;
          const newLevel = Math.floor(newXP / 100) + 1;
          const xpToNext = (newLevel * 100) - newXP;
          
          return {
            ...prev,
            xp: newXP,
            level: newLevel,
            xpToNext: xpToNext > 0 ? xpToNext : 100,
            gems: prev.gems + Math.floor(amount / 10)
          };
        });
      };

      const renderDashboard = () => (
        <div className="space-y-8">
          {/* Welcome Section */}
          <div className="gn-paper">
            <div className="gn-paper-content p-8">
              <div className="text-center">
                <h2 className="gn-section-title">Welcome back, Scholar!</h2>
                <p className="gn-section-subtitle">Ready to continue your learning adventure?</p>
                
                {/* Stats Overview */}
                <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mt-8">
                  <div className="text-center">
                    <div className="gn-stats-circle" style={{background: 'linear-gradient(135deg, var(--gn-primary) 0%, var(--gn-purple) 100%)'}}>
                      <span className="text-white text-xl font-bold">{userStats.level}</span>
                    </div>
                    <p className="text-sm font-medium text-gray-600">Level</p>
                  </div>
                  
                  <div className="text-center">
                    <div className="gn-stats-circle" style={{background: 'linear-gradient(135deg, var(--gn-orange) 0%, var(--gn-pink) 100%)'}}>
                      <Icon name="flame" size={28} color="white" />
                    </div>
                    <p className="text-sm font-medium text-gray-600">{userStats.streak} Day Streak</p>
                  </div>
                  
                  <div className="text-center">
                    <div className="gn-stats-circle" style={{background: 'linear-gradient(135deg, var(--gn-secondary) 0%, var(--gn-teal) 100%)'}}>
                      <Icon name="gem" size={28} color="white" />
                    </div>
                    <p className="text-sm font-medium text-gray-600">{userStats.gems} Gems</p>
                  </div>
                  
                  <div className="text-center">
                    <div className="gn-stats-circle" style={{background: 'linear-gradient(135deg, var(--gn-purple) 0%, var(--gn-pink) 100())'}}>
                      <Icon name="layers" size={28} color="white" />
                    </div>
                    <p className="text-sm font-medium text-gray-600">{userStats.totalCards} Cards</p>
                  </div>
                </div>
                
                {/* Progress Bar */}
                <div className="mt-8">
                  <div className="flex justify-between text-sm text-gray-600 mb-2">
                    <span>Level {userStats.level}</span>
                    <span>{userStats.xpToNext} XP to next level</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-3">
                    <div 
                      className="bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-500"
                      style={{width: `${((100 - userStats.xpToNext) / 100) * 100}%`}}
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Quick Actions */}
          <div className="grid md:grid-cols-2 gap-6">
            <div className="gn-card">
              <div className="p-6">
                <div className="flex items-center space-x-4">
                  <div className="w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center">
                    <Icon name="book-open" size={24} color="var(--gn-primary)" />
                  </div>
                  <div className="flex-1">
                    <h3 className="font-semibold text-gray-900">Continue Studying</h3>
                    <p className="text-sm text-gray-600">Pick up where you left off</p>
                  </div>
                </div>
                <button onClick={() => showSection('study')} className="gn-button w-full mt-4">
                  Start Session
                </button>
              </div>
            </div>
            
            <div className="gn-card">
              <div className="p-6">
                <div className="flex items-center space-x-4">
                  <div className="w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center">
                    <Icon name="plus" size={24} color="var(--gn-secondary)" />
                  </div>
                  <div className="flex-1">
                    <h3 className="font-semibold text-gray-900">Create Cards</h3>
                    <p className="text-sm text-gray-600">Add new knowledge to your collection</p>
                  </div>
                </div>
                <button onClick={() => showSection('collection')} className="gn-button-secondary w-full mt-4">
                  Create New
                </button>
              </div>
            </div>
          </div>
        </div>
      );

      const renderCurrentSection = () => {
        switch(currentSection) {
          case 'dashboard':
            return renderDashboard();
          case 'study':
            return <div className="gn-paper"><div className="gn-paper-content p-8"><p>Study section - coming soon with GoodNotes 6 design!</p></div></div>;
          case 'collection':
            return <div className="gn-paper"><div className="gn-paper-content p-8"><p>Collection section - coming soon with GoodNotes 6 design!</p></div></div>;
          case 'quests':
            return <div className="gn-paper"><div className="gn-paper-content p-8"><p>Quests section - coming soon with GoodNotes 6 design!</p></div></div>;
          case 'leaderboard':
            return <div className="gn-paper"><div className="gn-paper-content p-8"><p>Leaderboard section - coming soon with GoodNotes 6 design!</p></div></div>;
          case 'avatar':
            return <div className="gn-paper"><div className="gn-paper-content p-8"><p>Avatar section - coming soon with GoodNotes 6 design!</p></div></div>;
          default:
            return renderDashboard();
        }
      };

      return (
        <div className="min-h-screen" style={{background: 'var(--gn-background)'}}>
          {/* Header */}
          <div className="gn-header">
            <div className="gn-container">
              <div className="flex items-center justify-between py-4">
                <div className="flex items-center space-x-6">
                  <h1 style={{fontSize: '28px', fontWeight: '700', color: 'var(--gn-text-primary)', margin: '0'}}>
                    ANKID
                  </h1>
                  <div className="gn-badge" style={{background: 'linear-gradient(135deg, var(--gn-orange) 0%, var(--gn-pink) 100%)', color: 'white'}}>
                    Gamified Learning Adventure
                  </div>
                </div>
                
                <div className="flex items-center space-x-3">
                  <button className="gn-icon-button">
                    <Icon name="mic" />
                  </button>
                  <button className="gn-icon-button">
                    <Icon name="settings" />
                  </button>
                </div>
              </div>
              
              {/* Navigation */}
              <div className="flex space-x-2 pb-4">
                <button onClick={() => showSection('dashboard')} className={`gn-nav-tab ${currentSection === 'dashboard' ? 'active' : ''}`}>Dashboard</button>
                <button onClick={() => showSection('study')} className={`gn-nav-tab ${currentSection === 'study' ? 'active' : ''}`}>Study</button>
                <button onClick={() => showSection('collection')} className={`gn-nav-tab ${currentSection === 'collection' ? 'active' : ''}`}>Collection</button>
                <button onClick={() => showSection('quests')} className={`gn-nav-tab ${currentSection === 'quests' ? 'active' : ''}`}>Quests</button>
                <button onClick={() => showSection('leaderboard')} className={`gn-nav-tab ${currentSection === 'leaderboard' ? 'active' : ''}`}>Leaderboard</button>
                <button onClick={() => showSection('avatar')} className={`gn-nav-tab ${currentSection === 'avatar' ? 'active' : ''}`}>Avatar</button>
              </div>
            </div>
          </div>

          {/* Main Content */}
          <div className="gn-container py-8">
            {renderCurrentSection()}
          </div>
        </div>
      );
    };

    // Render the app
    ReactDOM.render(<ANKIDApp />, document.getElementById('root'));
  </script>
        'send': <path strokeLinecap="round" strokeLinejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/>,
        'check-circle': <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>,
        'x-circle': <path strokeLinecap="round" strokeLinejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>,
        'arrow-left': <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"/>,
        
        // Card/Rarity Icons
        'circle': <circle cx="12" cy="12" r="10"/>,
        'diamond': <path d="M6 3h12l4 6-10 12L2 9l4-6z"/>,
        'star': <path strokeLinecap="round" strokeLinejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>,
        'crown': <path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4-8 3 8 3-8 4 8-7 6-7-6z"/>,
        
        // Mood Icons
        'smile': <g><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></g>,
        'heart': <path strokeLinecap="round" strokeLinejoin="round" d="M21 8.5c0-2.485-2.239-4.5-5-4.5-1.664 0-3.122.765-4 1.977C11.122 4.765 9.664 4 8 4 5.239 4 3 6.015 3 8.5s2.239 4.5 5 4.5c1.664 0 3.122-.765 4-1.977.878 1.212 2.336 1.977 4 1.977 2.761 0 5-2.015 5-4.5z"/>,
        'eye': <g><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></g>,
        'palette': <g><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 011.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></g>,
        
        // Additional icons
        'rocket': <g><path d="M4.5 16.5c-1.5 1.5-1.5 4 0 5.5s4 1.5 5.5 0L12 20l-3-3m0 0l-3-3 1.5-1.5L10 15"/><path d="M15 7a5 5 0 010 7 5 5 0 010-7z"/><path d="M13 6.5L15.5 9l-6 6-2.5-2.5 6-6z"/></g>,
        'waves': <g><path d="M2 12c.5-2 2.5-4 5-4s4.5 2 5 4 2.5 4 5 4 4.5-2 5-4"/><path d="M2 20c.5-2 2.5-4 5-4s4.5 2 5 4 2.5 4 5 4 4.5-2 5-4"/></g>,
        'book-text': <g><path d="M4 6v15a1 1 0 001 1h14a1 1 0 001-1V6"/><path d="M4 6l16-2v2L4 8V6z"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="8" y1="16" x2="16" y2="16"/></g>,
        'telescope': <g><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6"/><path d="M17.6 6.4L14.83 9.17m-5.66 5.66L6.4 17.6"/><path d="M6.4 6.4l2.77 2.77m5.66 5.66l2.77 2.77"/></g>,
        'wand-2': <path d="M15 4V2m0 14v-2M8 9h2m10 0h2M2.586 16.414L5.5 13.5M18.5 13.5l2.914 2.914M13.5 5.5L16.414 2.586M5.5 18.5L2.586 15.586"/>,
        'wand': <path d="M15 4V2m0 14v-2M8 9h2m10 0h2M2.586 16.414L5.5 13.5M18.5 13.5l2.914 2.914M13.5 5.5L16.414 2.586M5.5 18.5L2.586 15.586"/>,
        'glasses': <g><circle cx="6" cy="15" r="4"/><circle cx="18" cy="15" r="4"/><path d="M14 15a2 2 0 00-4 0"/></g>,
        'globe': <g><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></g>,
        'trending-up': <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941"/>,
        'calendar-check': <g><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><path d="M9 16l2 2 4-4"/></g>
      };

      const iconPath = icons[name] || icons['circle'];
      
      return (
        <svg 
          width={size} 
          height={size} 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke={color} 
          strokeWidth="2" 
          className={`inline-block ${className}`}
          style={{ minWidth: size, minHeight: size }}
        >
          {iconPath}
        </svg>
      );
    };

    // Enhanced Game Data with clean icons
    const CARD_SERIES = {
      'Space Explorer': {
        cards: ['Rocket Ship', 'Asteroid Belt', 'Mars Colony', 'Space Station', 'Nebula'],
        theme: 'space',
        description: 'Explore the cosmos!',
        icon: 'rocket'
      },
      'Ocean Adventure': {
        cards: ['Deep Sea Diver', 'Coral Reef', 'Whale Song', 'Treasure Chest', 'Submarine'],
        theme: 'ocean',
        description: 'Dive into marine mysteries!',
        icon: 'waves'
      },
      'Math Masters': {
        cards: ['Golden Ratio', 'Prime Numbers', 'Fibonacci', 'Pi Explorer', 'Infinity'],
        theme: 'math',
        description: 'Master mathematical concepts!',
        icon: 'calculator'
      },
      'Language Legends': {
        cards: ['Word Wizard', 'Grammar Guardian', 'Story Sage', 'Poem Pioneer', 'Script Scholar'],
        theme: 'language',
        description: 'Become a language master!',
        icon: 'book-open'
      },
      'Science Squad': {
        cards: ['Lab Genius', 'Element Expert', 'Physics Phenomenon', 'Biology Boss', 'Chemistry Champion'],
        theme: 'science',
        description: 'Discover scientific wonders!',
        icon: 'flask-conical'
      }
    };

    const AVATAR_OPTIONS = {
      ender: { name: 'Ender', icon: 'sparkles', personality: 'curious', voice: 'enthusiastic' },
      echo: { name: 'Echo', icon: 'bot', personality: 'logical', voice: 'calm' },
      amber: { name: 'Amber', icon: 'zap', personality: 'encouraging', voice: 'warm' },
      sage: { name: 'Sage', icon: 'graduation-cap', personality: 'wise', voice: 'patient' }
    };

    const AVATAR_COSMETICS = {
      outfits: [
        { id: 'space_suit', name: 'Space Suit', cost: 50, icon: 'rocket' },
        { id: 'wizard_robe', name: 'Wizard Robe', cost: 75, icon: 'wand-2' },
        { id: 'lab_coat', name: 'Lab Coat', cost: 60, icon: 'flask-conical' },
        { id: 'crown', name: 'Golden Crown', cost: 100, icon: 'crown' }
      ],
      accessories: [
        { id: 'glasses', name: 'Smart Glasses', cost: 30, icon: 'glasses' },
        { id: 'hat', name: 'Thinking Cap', cost: 40, icon: 'graduation-cap' },
        { id: 'wand', name: 'Magic Wand', cost: 80, icon: 'wand' }
      ]
    };

    const QUEST_SYSTEM = {
      galaxy_explorer: {
        title: "Galaxy Explorer",
        description: "Help your avatar explore the cosmos by mastering space science!",
        icon: 'telescope',
        requirements: [
          { type: 'cards', series: 'Space Explorer', count: 3 },
          { type: 'quiz_score', subject: 'science', score: 80 }
        ],
        reward: { gems: 200, card: 'legendary', achievement: 'Space Pioneer' },
        story: "The universe needs your help! Complete space science quizzes to unlock cosmic secrets."
      },
      ocean_depths: {
        title: "Ocean Depths Explorer",
        description: "Dive deep into marine biology and ocean science!",
        icon: 'waves',
        requirements: [
          { type: 'cards', series: 'Ocean Adventure', count: 4 },
          { type: 'streak', count: 5 }
        ],
        reward: { gems: 150, card: 'epic', achievement: 'Deep Sea Detective' }
      },
      word_wizard: {
        title: "Word Wizard",
        description: "Master the art of language and become a vocabulary champion!",
        icon: 'book-text',
        requirements: [
          { type: 'quiz_score', subject: 'english', score: 90 },
          { type: 'teaching_sessions', count: 3 }
        ],
        reward: { gems: 180, cosmetic: 'wizard_robe', achievement: 'Language Master' }
      }
    };

    const ENHANCED_QUESTION_BANKS = {
      math: {
        beginner: [
          { question: "What is 3 + 4?", answer: "7", difficulty: 1, hint: "Count on your fingers!" },
          { question: "What is 10 - 6?", answer: "4", difficulty: 1, hint: "Take away 6 from 10" },
          { question: "How many sides does a triangle have?", answer: "3", difficulty: 1, hint: "Tri means three!" }
        ],
        intermediate: [
          { question: "What is 7 × 8?", answer: "56", difficulty: 2, hint: "Think of the times table" },
          { question: "What is 144 ÷ 12?", answer: "12", difficulty: 2, hint: "How many 12s fit into 144?" },
          { question: "What is the area of a rectangle with length 5 and width 3?", answer: "15", difficulty: 2, hint: "Length × Width" }
        ],
        advanced: [
          { question: "What is the square root of 81?", answer: "9", difficulty: 3, hint: "What number times itself equals 81?" },
          { question: "If x + 5 = 12, what is x?", answer: "7", difficulty: 3, hint: "What do you add to 5 to get 12?" }
        ]
      },
      science: {
        beginner: [
          { question: "What do plants need to grow?", answer: "sunlight", difficulty: 1, hint: "Think about what makes plants green and healthy" },
          { question: "How many legs does a spider have?", answer: "8", difficulty: 1, hint: "More than an insect!" }
        ],
        intermediate: [
          { question: "What gas do plants absorb during photosynthesis?", answer: "carbon dioxide", difficulty: 2, hint: "It's what we breathe out" },
          { question: "What is the closest planet to the Sun?", answer: "mercury", difficulty: 2, hint: "It's named after a Roman god" }
        ],
        advanced: [
          { question: "What is the chemical symbol for gold?", answer: "au", difficulty: 3, hint: "From the Latin word 'aurum'" },
          { question: "How many chambers does a human heart have?", answer: "4", difficulty: 3, hint: "Two on each side" }
        ]
      },
      english: {
        beginner: [
          { question: "Complete: The cat ___ on the mat", answer: "sat", difficulty: 1, hint: "Past tense of 'sit'" },
          { question: "What is the opposite of 'hot'?", answer: "cold", difficulty: 1, hint: "Think about ice!" }
        ],
        intermediate: [
          { question: "What is the past tense of 'run'?", answer: "ran", difficulty: 2, hint: "Yesterday I ___" },
          { question: "Complete: She ___ to the store yesterday", answer: "went", difficulty: 2, hint: "Past tense of 'go'" }
        ],
        advanced: [
          { question: "What is a group of lions called?", answer: "pride", difficulty: 3, hint: "It's also a feeling of satisfaction" },
          { question: "What literary device compares two things using 'like' or 'as'?", answer: "simile", difficulty: 3, hint: "Not a metaphor!" }
        ]
      }
    };

    const LEADERBOARD_TYPES = {
      gems: { title: "Gem Champions", icon: "gem" },
      cards: { title: "Card Collectors", icon: "layers" },
      streak: { title: "Streak Masters", icon: "flame" },
      improvement: { title: "Most Improved", icon: "trending-up" },
      consistency: { title: "Consistent Learners", icon: "calendar-check" },
      teaching: { title: "Best Teachers", icon: "graduation-cap" }
    };

    const LANGUAGES = {
      en: { name: 'English', flag: '🇺🇸', voice: 'en-US', icon: 'globe' },
      zh: { name: '中文', flag: '🇨🇳', voice: 'zh-CN', icon: 'globe' },
      es: { name: 'Español', flag: '🇪🇸', voice: 'es-ES', icon: 'globe' },
      fr: { name: 'Français', flag: '🇫🇷', voice: 'fr-FR', icon: 'globe' }
    };

    // Quest Panel Component
    const QuestPanel = ({ quests, onClose, onCompleteQuest }) => {
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-2xl p-6 max-w-lg w-full mx-4 max-h-96 overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-2xl font-bold">⚔️ Active Quests</h2>
              <button onClick={onClose} className="text-gray-500 hover:text-gray-700">✕</button>
            </div>

            {quests.length === 0 ? (
              <div className="text-center py-8">
                <div className="text-6xl mb-4">🗡️</div>
                <p className="text-gray-600">No active quests yet!</p>
                <p className="text-sm text-gray-500">Complete quizzes and collect cards to unlock quests!</p>
              </div>
            ) : (
              <div className="space-y-4">
                {quests.map((quest, index) => (
                  <div key={index} className="border rounded-lg p-4 quest-glow">
                    <h3 className="font-bold text-lg mb-2">{quest.title}</h3>
                    <p className="text-gray-600 text-sm mb-3">{quest.description}</p>
                    
                    <div className="space-y-2 mb-3">
                      <h4 className="font-semibold text-sm">Requirements:</h4>
                      {quest.requirements.map((req, reqIndex) => (
                        <div key={reqIndex} className="text-xs bg-gray-100 p-2 rounded">
                          {req.type === 'cards' && `Collect ${req.count} cards from ${req.series} series`}
                          {req.type === 'quiz_score' && `Score ${req.score}% in ${req.subject} quiz`}
                          {req.type === 'streak' && `Achieve ${req.count} day streak`}
                          {req.type === 'teaching_sessions' && `Complete ${req.count} teaching sessions`}
                        </div>
                      ))}
                    </div>
                    
                    <div className="text-xs text-green-600">
                      <strong>Rewards:</strong> {quest.reward.gems} gems
                      {quest.reward.card && `, ${quest.reward.card} card`}
                      {quest.reward.achievement && `, "${quest.reward.achievement}" achievement`}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    };

    // Enhanced Learning Ambassador Component with GoodNotes 6 Style and Lucide Icons
    const LearningAmbassador = ({ 
      avatar, 
      isListening, 
      onSpeak, 
      onCustomize, 
      currentQuest, 
      mood = 'happy' 
    }) => {
      const [isAnimating, setIsAnimating] = useState(false);
      
      const handleClick = () => {
        setIsAnimating(true);
        onSpeak();
        setTimeout(() => setIsAnimating(false), 1000);
      };

      const moodIcons = {
        excited: 'zap',
        encouraging: 'heart',
        proud: 'trophy',
        thinking: 'brain',
        happy: 'smile',
        curious: 'eye'
      };

      return (
        <div className="fixed bottom-6 right-6 z-50">
          <div className={`relative ${isAnimating ? 'scale-110' : ''} transition-all duration-300 avatar-float`}>
            {/* Quest indicator */}
            {currentQuest && (
              <div className="absolute -top-10 -left-4 bg-orange-500 text-white text-xs px-3 py-2 rounded-full font-semibold quest-highlight flex items-center">
                <Icon name="swords" size={12} className="mr-1" />
                Quest Active!
              </div>
            )}
            
            <div 
              className="goodnotes-card cursor-pointer relative p-4 hover:shadow-lg"
              onClick={handleClick}
              style={{
                background: 'linear-gradient(135deg, var(--goodnotes-primary) 0%, var(--goodnotes-purple) 100%)',
                width: '80px',
                height: '80px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center'
              }}
            >
              <div className="text-white text-center">
                <div className="mb-1">
                  <Icon name={avatar.icon} size={24} color="white" />
                </div>
                <div className="text-xs font-semibold">{avatar.name}</div>
                {isListening && (
                  <div className="animate-pulse mt-1">
                    <Icon name="mic" size={12} color="#FCD34D" />
                  </div>
                )}
              </div>
              
              {/* Mood indicator */}
              <div className="absolute -top-2 -right-2 bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-md">
                <Icon name={moodIcons[mood] || 'smile'} size={16} color="#6B7280" />
              </div>
            </div>
            
            {/* Customize button */}
            <button
              onClick={onCustomize}
              className="absolute -bottom-3 -left-3 bg-white text-gray-600 rounded-full w-8 h-8 text-sm hover:bg-gray-50 shadow-lg goodnotes-card flex items-center justify-center tooltip"
              data-tooltip="Customize Avatar"
            >
              <Icon name="palette" size={16} />
            </button>
          </div>
        </div>
      );
    };

    // Enhanced Card Component with GoodNotes 6 Style and Lucide Icons
    const Card = ({ series, name, rarity, isNew = false, utility = null, onClick }) => {
      const rarityColors = {
        common: 'linear-gradient(135deg, #E5E5EA 0%, #D1D1D6 100%)',
        rare: 'linear-gradient(135deg, #007AFF 0%, #0056CC 100%)',
        epic: 'linear-gradient(135deg, #AF52DE 0%, #8E44AD 100%)',
        legendary: 'linear-gradient(135deg, #FF9500 0%, #E67E22 100%)'
      };

      const rarityIcons = {
        common: 'circle',
        rare: 'diamond',
        epic: 'star',
        legendary: 'crown'
      };

      const seriesIcon = CARD_SERIES[series]?.icon || 'card';

      return (
        <div 
          className={`relative w-28 h-36 cursor-pointer transform transition-all hover:scale-105 ${isNew ? 'card-collect' : ''}`}
          onClick={onClick}
          style={{
            background: rarityColors[rarity],
            borderRadius: '12px',
            boxShadow: isNew ? '0 8px 25px rgba(0, 122, 255, 0.3)' : '0 4px 15px var(--goodnotes-shadow)',
            border: '2px solid rgba(255, 255, 255, 0.2)'
          }}
        >
          <div className="absolute inset-2 bg-white bg-opacity-95 rounded-lg flex flex-col justify-between p-3 paper-texture">
            <div className="text-center">
              <div className="text-xs font-semibold text-gray-600 mb-2">{series}</div>
              <div className="flex justify-center mb-2">
                <Icon name={seriesIcon} size={20} color="#6B7280" />
              </div>
            </div>
            
            <div className="text-center">
              {utility && (
                <div className="bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded-full mb-2 font-semibold flex items-center justify-center">
                  <Icon name="zap" size={12} className="mr-1" />
                  USE
                </div>
              )}
              <div className="text-xs font-semibold text-gray-800 leading-tight mb-1">{name}</div>
              <div className="flex justify-center">
                <Icon name={rarityIcons[rarity]} size={12} color="#9CA3AF" />
              </div>
            </div>
          </div>
          
          {isNew && (
            <div className="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-2 py-1 font-bold animate-pulse flex items-center">
              <Icon name="sparkles" size={10} className="mr-1" />
              NEW
            </div>
          )}
          
          <div className={`absolute bottom-1 right-1 w-3 h-3 rounded-full`} 
               style={{ background: rarityColors[rarity] }}></div>
        </div>
      );
    };

    // Settings Component - GoodNotes 6 Style
    const SettingsPanel = ({ settings, onUpdateSettings, onClose }) => {
      const [localSettings, setLocalSettings] = useState(settings);

      const handleSave = () => {
        onUpdateSettings(localSettings);
        onClose();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="goodnotes-card max-w-lg w-full max-h-96 overflow-y-auto">
            <div className="p-6">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-2xl font-semibold text-gray-800">⚙️ Settings</h2>
                <button 
                  onClick={onClose} 
                  className="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200 transition-colors"
                >
                  ✕
                </button>
              </div>

              <div className="space-y-6">
                {/* Language Selection */}
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-3">🌐 Language</label>
                  <select 
                    value={localSettings.language}
                    onChange={(e) => setLocalSettings({...localSettings, language: e.target.value})}
                    className="goodnotes-input w-full"
                  >
                    {Object.entries(LANGUAGES).map(([code, lang]) => (
                      <option key={code} value={code}>{lang.flag} {lang.name}</option>
                    ))}
                  </select>
                </div>

                {/* Speech Settings */}
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-3">🗣️ Speech Rate</label>
                  <input
                    type="range"
                    min="0.5"
                    max="2"
                    step="0.1"
                    value={localSettings.speechRate}
                    onChange={(e) => setLocalSettings({...localSettings, speechRate: parseFloat(e.target.value)})}
                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    style={{
                      background: `linear-gradient(to right, var(--goodnotes-primary) 0%, var(--goodnotes-primary) ${(localSettings.speechRate - 0.5) / 1.5 * 100}%, var(--goodnotes-gray-2) ${(localSettings.speechRate - 0.5) / 1.5 * 100}%, var(--goodnotes-gray-2) 100%)`
                    }}
                  />
                  <div className="text-xs text-gray-600 mt-1">Speed: {localSettings.speechRate}x</div>
                </div>

                {/* Accessibility Options */}
                <div className="space-y-4">
                  <h3 className="text-sm font-semibold text-gray-700">♿ Accessibility</h3>
                  {[
                    { key: 'dyslexiaFriendly', label: '📖 Dyslexia-friendly font', icon: '📖' },
                    { key: 'highContrast', label: '🔆 High contrast mode', icon: '🔆' },
                    { key: 'reducedMotion', label: '🎭 Reduced animations', icon: '🎭' },
                    { key: 'privateMode', label: '� Private mode', icon: '🔒' }
                  ].map(option => (
                    <label key={option.key} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors">
                      <span className="text-sm font-medium text-gray-700">{option.label}</span>
                      <input
                        type="checkbox"
                        checked={localSettings[option.key]}
                        onChange={(e) => setLocalSettings({...localSettings, [option.key]: e.target.checked})}
                        className="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                      />
                    </label>
                  ))}
                </div>

                <button
                  onClick={handleSave}
                  className="goodnotes-button w-full py-3"
                >
                  Save Settings
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Avatar Customization Component
    const AvatarCustomizer = ({ currentAvatar, cosmetics, onUpdateAvatar, onClose }) => {
      const [selectedAvatar, setSelectedAvatar] = useState(currentAvatar.type);
      const [selectedCosmetics, setSelectedCosmetics] = useState(currentAvatar.cosmetics || []);

      const handleSave = () => {
        onUpdateAvatar({
          type: selectedAvatar,
          cosmetics: selectedCosmetics,
          ...AVATAR_OPTIONS[selectedAvatar]
        });
        onClose();
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-2xl p-6 max-w-lg w-full mx-4 max-h-96 overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-2xl font-bold">✨ Customize Avatar</h2>
              <button onClick={onClose} className="text-gray-500 hover:text-gray-700">✕</button>
            </div>

            {/* Avatar Selection */}
            <div className="mb-6">
              <h3 className="text-lg font-semibold mb-3">Choose Your Companion</h3>
              <div className="grid grid-cols-2 gap-3">
                {Object.entries(AVATAR_OPTIONS).map(([key, avatar]) => (
                  <button
                    key={key}
                    onClick={() => setSelectedAvatar(key)}
                    className={`p-4 rounded-lg border-2 transition-all ${
                      selectedAvatar === key 
                        ? 'border-blue-500 bg-blue-50' 
                        : 'border-gray-200 hover:border-gray-300'
                    }`}
                  >
                    <div className="text-3xl mb-2">{avatar.icon}</div>
                    <div className="font-semibold">{avatar.name}</div>
                    <div className="text-xs text-gray-600">{avatar.personality}</div>
                  </button>
                ))}
              </div>
            </div>

            {/* Cosmetics */}
            <div className="mb-6">
              <h3 className="text-lg font-semibold mb-3">Cosmetics</h3>
              <div className="space-y-3">
                {Object.entries(AVATAR_COSMETICS).map(([category, items]) => (
                  <div key={category}>
                    <h4 className="text-sm font-medium text-gray-700 mb-2 capitalize">{category}</h4>
                    <div className="grid grid-cols-3 gap-2">
                      {items.map((item) => {
                        const isOwned = cosmetics.includes(item.id);
                        const isSelected = selectedCosmetics.includes(item.id);
                        
                        return (
                          <button
                            key={item.id}
                            onClick={() => {
                              if (isOwned) {
                                setSelectedCosmetics(prev => 
                                  isSelected 
                                    ? prev.filter(id => id !== item.id)
                                    : [...prev, item.id]
                                );
                              }
                            }}
                            disabled={!isOwned}
                            className={`p-2 rounded border text-sm ${
                              !isOwned 
                                ? 'border-gray-200 opacity-50 cursor-not-allowed'
                                : isSelected
                                ? 'border-blue-500 bg-blue-50'
                                : 'border-gray-300 hover:border-gray-400'
                            }`}
                          >
                            <div className="text-lg">{item.icon}</div>
                            <div className="text-xs">{item.name}</div>
                            {!isOwned && <div className="text-xs text-yellow-600">💎{item.cost}</div>}
                          </button>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <button
              onClick={handleSave}
              className="w-full bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600"
            >
              Save Customization
            </button>
          </div>
        </div>
      );
    };

    // Enhanced Ranking Component
    const EnhancedRanking = ({ players, currentPlayer, leaderboardType, onChangeType }) => {
      const sortedPlayers = [...players].sort((a, b) => {
        switch(leaderboardType) {
          case 'gems': return b.gems - a.gems;
          case 'cards': return b.cards - a.cards;
          case 'streak': return (b.maxStreak || 0) - (a.maxStreak || 0);
          case 'improvement': return (b.improvement || 0) - (a.improvement || 0);
          case 'consistency': return (b.consistency || 0) - (a.consistency || 0);
          case 'teaching': return (b.teachingSessions || 0) - (a.teachingSessions || 0);
          default: return b.gems - a.gems;
        }
      });

      return (
        <div className="bg-white rounded-lg shadow-lg p-4">
          <div className="flex justify-between items-center mb-4">
            <h3 className="text-lg font-bold">{LEADERBOARD_TYPES[leaderboardType].title}</h3>
            <select 
              value={leaderboardType}
              onChange={(e) => onChangeType(e.target.value)}
              className="text-sm border rounded px-2 py-1"
            >
              {Object.entries(LEADERBOARD_TYPES).map(([key, type]) => (
                <option key={key} value={key}>{type.icon} {type.title}</option>
              ))}
            </select>
          </div>

          {sortedPlayers.slice(0, 10).map((player, index) => (
            <div key={index} className={`flex justify-between items-center p-2 rounded mb-1 ${
              player.name === currentPlayer ? 'bg-yellow-100 border-2 border-yellow-400' : 'hover:bg-gray-50'
            }`}>
              <div className="flex items-center">
                <span className="text-lg mr-3 w-8">
                  {index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}.`}
                </span>
                <div>
                  <span className="font-semibold">{player.name}</span>
                  {player.name === currentPlayer && <span className="text-xs text-blue-600 ml-2">(You)</span>}
                </div>
              </div>
              <div className="text-right">
                <div className="font-bold text-lg">
                  {LEADERBOARD_TYPES[leaderboardType].icon} {player[leaderboardType] || player.gems}
                </div>
                {leaderboardType === 'improvement' && (
                  <div className="text-xs text-green-600">+{player.improvement}% this week</div>
                )}
              </div>
            </div>
          ))}
        </div>
      );
    };

    // Main App Component
    const AnkidAdvancedApp = () => {
      // Core Game State
      const [currentView, setCurrentView] = useState('dashboard');
      const [playerName, setPlayerName] = useState('Explorer');
      const [gems, setGems] = useState(0);
      const [collectedCards, setCollectedCards] = useState([]);
      const [achievements, setAchievements] = useState([]);
      const [streak, setStreak] = useState(0);
      const [maxStreak, setMaxStreak] = useState(0);
      
      // Enhanced Features State
      const [currentAvatar, setCurrentAvatar] = useState({
        type: 'ender',
        cosmetics: [],
        ...AVATAR_OPTIONS.ender
      });
      const [ownedCosmetics, setOwnedCosmetics] = useState([]);
      const [activeQuests, setActiveQuests] = useState([]);
      const [completedQuests, setCompletedQuests] = useState([]);
      const [leaderboardType, setLeaderboardType] = useState('gems');
      const [difficultyLevel, setDifficultyLevel] = useState('intermediate');
      const [teachingSessions, setTeachingSessions] = useState(0);
      
      // Quiz State
      const [currentSubject, setCurrentSubject] = useState('math');
      const [currentQuestion, setCurrentQuestion] = useState(null);
      const [userAnswer, setUserAnswer] = useState('');
      const [feedback, setFeedback] = useState('');
      const [score, setScore] = useState(0);
      const [questionIndex, setQuestionIndex] = useState(0);
      const [showHint, setShowHint] = useState(false);
      const [useTextInput, setUseTextInput] = useState(false);
      
      // Speech and Interaction State
      const [isListening, setIsListening] = useState(false);
      const [isSpeaking, setIsSpeaking] = useState(false);
      const [avatarMood, setAvatarMood] = useState('happy');
      
      // UI State
      const [showSettings, setShowSettings] = useState(false);
      const [showAvatarCustomizer, setShowAvatarCustomizer] = useState(false);
      const [showQuests, setShowQuests] = useState(false);
      
      // Settings State
      const [settings, setSettings] = useState({
        language: 'en',
        speechRate: 1.0,
        dyslexiaFriendly: false,
        highContrast: false,
        reducedMotion: false,
        privateMode: false,
        parentalControls: {
          maxScreenTime: 120, // minutes
          restrictTrading: false,
          ageAppropriate: true
        }
      });

      // Mock enhanced ranking data
      const [rankings, setRankings] = useState([
        { name: 'Sarah', gems: 1250, cards: 45, maxStreak: 15, improvement: 25, consistency: 90, teachingSessions: 8 },
        { name: 'Alex', gems: 1100, cards: 38, maxStreak: 12, improvement: 18, consistency: 85, teachingSessions: 5 },
        { name: 'Emma', gems: 950, cards: 42, maxStreak: 20, improvement: 30, consistency: 95, teachingSessions: 12 },
        { name: 'Explorer', gems: 0, cards: 0, maxStreak: 0, improvement: 0, consistency: 0, teachingSessions: 0 },
        { name: 'Jack', gems: 800, cards: 25, maxStreak: 8, improvement: 15, consistency: 70, teachingSessions: 3 },
        { name: 'Luna', gems: 750, cards: 30, maxStreak: 10, improvement: 22, consistency: 80, teachingSessions: 6 }
      ]);

      // Enhanced Speech Functions with Multiple Languages
      const speak = useCallback((text, callback) => {
        if (window.speechSynthesis && !settings.reducedMotion) {
          setIsSpeaking(true);
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.rate = settings.speechRate;
          utterance.pitch = currentAvatar.personality === 'enthusiastic' ? 1.2 : 1.0;
          utterance.lang = LANGUAGES[settings.language].voice;
          
          utterance.onend = () => {
            setIsSpeaking(false);
            if (callback) callback();
          };
          window.speechSynthesis.speak(utterance);
        }
      }, [settings.speechRate, settings.language, currentAvatar.personality, settings.reducedMotion]);

      const listen = useCallback(() => {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
          setUseTextInput(true);
          speak("Speech recognition isn't available. You can type your answer instead!");
          return;
        }

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = LANGUAGES[settings.language].voice;

        setIsListening(true);
        setAvatarMood('thinking');
        
        recognition.onresult = (event) => {
          const spokenText = event.results[0][0].transcript.toLowerCase().trim();
          setUserAnswer(spokenText);
          checkAnswer(spokenText);
        };

        recognition.onerror = (event) => {
          console.error('Speech recognition error:', event.error);
          setIsListening(false);
          setAvatarMood('encouraging');
          speak("I couldn't hear you clearly. Try speaking again or use the text input!");
          setUseTextInput(true);
        };

        recognition.onend = () => {
          setIsListening(false);
          setAvatarMood('happy');
        };

        recognition.start();
      }, [settings.language]);

      // Adaptive Difficulty System
      const adaptDifficulty = useCallback((currentScore, streak) => {
        if (streak >= 5 && currentScore >= 80) {
          return 'advanced';
        } else if (streak >= 3 || currentScore >= 60) {
          return 'intermediate';
        } else {
          return 'beginner';
        }
      }, []);

      // Enhanced Game Logic
      const generateRandomCard = useCallback(() => {
        const seriesNames = Object.keys(CARD_SERIES);
        const randomSeries = seriesNames[Math.floor(Math.random() * seriesNames.length)];
        const cards = CARD_SERIES[randomSeries].cards;
        const randomCard = cards[Math.floor(Math.random() * cards.length)];
        
        const rarities = ['common', 'rare', 'epic', 'legendary'];
        const rarityWeights = difficultyLevel === 'advanced' ? [40, 35, 20, 5] : [50, 30, 15, 5];
        let random = Math.random() * 100;
        let rarity = 'common';
        
        for (let i = 0; i < rarities.length; i++) {
          if (random < rarityWeights[i]) {
            rarity = rarities[i];
            break;
          }
          random -= rarityWeights[i];
        }

        // Add utility to some cards
        const utility = Math.random() < 0.2 ? {
          type: 'bonus_gems',
          value: 10,
          description: 'Use for +10 bonus gems'
        } : null;

        return { 
          series: randomSeries, 
          name: randomCard, 
          rarity, 
          utility,
          id: Date.now() + Math.random() 
        };
      }, [difficultyLevel]);

      const checkAnswer = useCallback((answer) => {
        if (!currentQuestion) return;
        
        const isCorrect = answer.toLowerCase().trim() === currentQuestion.answer.toLowerCase().trim();
        setUserAnswer(answer);
        
        if (isCorrect) {
          const newGems = gems + (currentQuestion.difficulty * 10);
          setGems(newGems);
          setScore(score + 1);
          setStreak(streak + 1);
          setMaxStreak(Math.max(maxStreak, streak + 1));
          setAvatarMood('proud');
          
          const newCard = generateRandomCard();
          setCollectedCards(prev => [...prev, { ...newCard, isNew: true }]);
          
          setFeedback(`🎉 Correct! You earned ${currentQuestion.difficulty * 10} gems and a new card!`);
          speak(`Amazing! That's correct! You earned ${currentQuestion.difficulty * 10} gems and found a ${newCard.rarity} ${newCard.name} card!`);
          
          // Update rankings
          setRankings(prev => prev.map(player => 
            player.name === playerName 
              ? { ...player, gems: newGems, cards: collectedCards.length + 1, maxStreak: Math.max(maxStreak, streak + 1) }
              : player
          ));
          
          setTimeout(() => {
            nextQuestion();
          }, 3000);
        } else {
          setStreak(0);
          setAvatarMood('encouraging');
          setFeedback(`Not quite right. The answer is "${currentQuestion.answer}". Let's try the next one!`);
          speak(`Not quite right. The answer is ${currentQuestion.answer}. Don't worry, let's try the next question!`);
          
          setTimeout(() => {
            nextQuestion();
          }, 4000);
        }
      }, [currentQuestion, gems, score, streak, maxStreak, collectedCards, playerName, generateRandomCard, speak]);

      const nextQuestion = useCallback(() => {
        const questions = ENHANCED_QUESTION_BANKS[currentSubject][difficultyLevel];
        if (questions && questions.length > 0) {
          const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
          setCurrentQuestion(randomQuestion);
          setUserAnswer('');
          setFeedback('');
          setShowHint(false);
          setQuestionIndex(prev => prev + 1);
          setAvatarMood('happy');
          
          speak(`Question ${questionIndex + 1}: ${randomQuestion.question}`);
        }
      }, [currentSubject, difficultyLevel, questionIndex, speak]);

      const useCard = useCallback((card) => {
        if (card.utility) {
          switch(card.utility.type) {
            case 'bonus_gems':
              setGems(prev => prev + card.utility.value);
              speak(`You used your ${card.name} card and earned ${card.utility.value} bonus gems!`);
              break;
            case 'hint_reveal':
              setShowHint(true);
              speak("Your card revealed the hint!");
              break;
            case 'skip_question':
              nextQuestion();
              speak("Your card helped you skip this question!");
              break;
          }
          
          // Remove the card after use
          setCollectedCards(prev => prev.filter(c => c.id !== card.id));
        }
      }, [speak, nextQuestion]);

      const startQuiz = useCallback((subject) => {
        setCurrentSubject(subject);
        setCurrentView('quiz');
        setScore(0);
        setQuestionIndex(0);
        const adaptedDifficulty = adaptDifficulty(score, streak);
        setDifficultyLevel(adaptedDifficulty);
        
        speak(`Let's start your ${subject} adventure! I've set the difficulty to ${adaptedDifficulty} based on your progress.`);
        
        setTimeout(() => {
          nextQuestion();
        }, 2000);
      }, [score, streak, adaptDifficulty, speak, nextQuestion]);

      const startTeachingMode = useCallback(() => {
        setCurrentView('teaching');
        setTeachingSessions(prev => prev + 1);
        setAvatarMood('excited');
        speak("Great! Teaching others is one of the best ways to learn. Choose a topic you'd like to teach, and I'll be your student!");
      }, [speak]);

      // Apply settings to UI
      useEffect(() => {
        document.body.className = '';
        if (settings.dyslexiaFriendly) document.body.classList.add('dyslexia-font');
        if (settings.highContrast) document.body.classList.add('high-contrast');
        if (settings.reducedMotion) document.body.classList.add('reduced-motion');
      }, [settings]);

      // Initialize first question
      useEffect(() => {
        if (currentView === 'quiz' && !currentQuestion) {
          nextQuestion();
        }
      }, [currentView, currentQuestion, nextQuestion]);

      // Update player in rankings
      useEffect(() => {
        setRankings(prev => prev.map(player => 
          player.name === playerName 
            ? { 
                ...player, 
                gems, 
                cards: collectedCards.length, 
                maxStreak,
                teachingSessions,
                improvement: Math.floor(Math.random() * 30), // Simulated improvement
                consistency: Math.min(95, 60 + streak * 5) // Based on streak
              }
            : player
        ));
      }, [gems, collectedCards.length, maxStreak, teachingSessions, streak, playerName]);

      // Quest system
      const checkQuestProgress = useCallback(() => {
        Object.entries(QUEST_SYSTEM).forEach(([questId, quest]) => {
          if (completedQuests.includes(questId) || activeQuests.find(q => q.id === questId)) return;
          
          let canStart = true;
          quest.requirements.forEach(req => {
            switch(req.type) {
              case 'cards':
                const seriesCards = collectedCards.filter(card => card.series === req.series);
                if (seriesCards.length < req.count) canStart = false;
                break;
              case 'quiz_score':
                if (score < req.score) canStart = false;
                break;
              case 'streak':
                if (maxStreak < req.count) canStart = false;
                break;
              case 'teaching_sessions':
                if (teachingSessions < req.count) canStart = false;
                break;
            }
          });
          
          if (canStart && !activeQuests.find(q => q.id === questId)) {
            setActiveQuests(prev => [...prev, { id: questId, ...quest, progress: 0 }]);
            setAvatarMood('excited');
            speak(`New quest available: ${quest.title}! ${quest.description}`);
          }
        });
      }, [collectedCards, score, maxStreak, teachingSessions, activeQuests, completedQuests, speak]);

      useEffect(() => {
        checkQuestProgress();
      }, [checkQuestProgress]);

      // Render different views
      const renderCurrentView = () => {
        switch(currentView) {
          case 'quiz':
            return (
              <div className="goodnotes-card p-8 notebook-line">
                <div className="flex justify-between items-center mb-6">
                  <div>
                    <h2 className="text-2xl font-semibold text-gray-800 mb-1 flex items-center">
                      <Icon 
                        name={currentSubject === 'math' ? 'calculator' : currentSubject === 'science' ? 'flask-conical' : 'book-open'} 
                        size={24} 
                        className="mr-2" 
                      />
                      {currentSubject.charAt(0).toUpperCase() + currentSubject.slice(1)} Quiz
                    </h2>
                    <p className="text-gray-600 text-sm">Question {questionIndex + 1} • Difficulty: {difficultyLevel}</p>
                  </div>
                  <div className="flex space-x-3">
                    <div className="bg-blue-100 text-blue-700 px-4 py-2 rounded-full text-sm font-medium flex items-center">
                      <Icon name="trophy" size={16} className="mr-1" />
                      Score: {score}
                    </div>
                    <div className="bg-purple-100 text-purple-700 px-4 py-2 rounded-full text-sm font-medium flex items-center">
                      <Icon name="flame" size={16} className="mr-1" />
                      Streak: {streak}
                    </div>
                  </div>
                </div>
                
                {currentQuestion && (
                  <div className="space-y-6">
                    <div className="bg-gray-50 p-6 rounded-2xl border-l-4 border-blue-500">
                      <div className="text-lg font-medium text-gray-800 leading-relaxed">
                        {currentQuestion.question}
                      </div>
                    </div>
                    
                    {showHint && (
                      <div className="bg-yellow-50 border border-yellow-200 p-4 rounded-2xl">
                        <div className="flex items-start">
                          <Icon name="lightbulb" size={20} color="#F59E0B" className="mr-3 mt-1" />
                          <div className="text-yellow-800 font-medium">{currentQuestion.hint}</div>
                        </div>
                      </div>
                    )}
                    
                    <div className="space-y-4">
                      {useTextInput ? (
                        <input
                          type="text"
                          value={userAnswer}
                          onChange={(e) => setUserAnswer(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && checkAnswer(userAnswer)}
                          className="goodnotes-input w-full text-lg"
                          placeholder="Type your answer here..."
                          autoFocus
                        />
                      ) : (
                        <button
                          onClick={listen}
                          disabled={isListening || isSpeaking}
                          className="goodnotes-button w-full py-4 text-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                        >
                          <Icon name="mic" size={20} className="mr-2" />
                          {isListening ? 'Listening...' : 'Speak Your Answer'}
                        </button>
                      )}
                      
                      <div className="flex space-x-4">
                        <button
                          onClick={() => setUseTextInput(!useTextInput)}
                          className="goodnotes-button-secondary flex-1 py-3 flex items-center justify-center"
                        >
                          <Icon name={useTextInput ? 'mic' : 'keyboard'} size={16} className="mr-2" />
                          {useTextInput ? 'Voice' : 'Text'}
                        </button>
                        
                        <button
                          onClick={() => setShowHint(true)}
                          className="goodnotes-button-secondary flex-1 py-3 flex items-center justify-center"
                          disabled={showHint}
                        >
                          <Icon name="lightbulb" size={16} className="mr-2" />
                          {showHint ? 'Hint Shown' : 'Show Hint'}
                        </button>
                      </div>
                      
                      {useTextInput && userAnswer && (
                        <button
                          onClick={() => checkAnswer(userAnswer)}
                          className="goodnotes-button w-full py-4 text-lg flex items-center justify-center"
                          style={{ background: 'var(--goodnotes-secondary)' }}
                        >
                          <Icon name="send" size={16} className="mr-2" />
                          Submit Answer
                        </button>
                      )}
                    </div>
                    
                    {feedback && (
                      <div className={`p-4 rounded-2xl font-medium flex items-start ${
                        feedback.includes('Correct') 
                          ? 'bg-green-50 text-green-800 border border-green-200' 
                          : 'bg-red-50 text-red-800 border border-red-200'
                      }`}>
                        <Icon name={feedback.includes('Correct') ? 'check-circle' : 'x-circle'} size={20} className="mr-3 mt-1" />
                        {feedback}
                      </div>
                    )}
                  </div>
                )}
                
                <div className="mt-8 pt-6 border-t border-gray-200">
                  <button
                    onClick={() => setCurrentView('dashboard')}
                    className="goodnotes-button-secondary flex items-center"
                  >
                    <Icon name="arrow-left" size={16} className="mr-2" />
                    Back to Dashboard
                  </button>
                </div>
              </div>
            );
            
          case 'cards':
            return (
              <div className="goodnotes-card p-8">
                <div className="flex justify-between items-center mb-6">
                  <div>
                    <h2 className="text-2xl font-semibold text-gray-800 mb-1">🃏 Your Card Collection</h2>
                    <p className="text-gray-600 text-sm">Total Cards: {collectedCards.length}</p>
                  </div>
                  <div className="flex space-x-4 text-sm">
                    <div className="text-center">
                      <div className="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center mb-1">○</div>
                      <span className="text-gray-600">{collectedCards.filter(c => c.rarity === 'common').length}</span>
                    </div>
                    <div className="text-center">
                      <div className="w-8 h-8 bg-blue-200 rounded-full flex items-center justify-center mb-1">◆</div>
                      <span className="text-blue-600">{collectedCards.filter(c => c.rarity === 'rare').length}</span>
                    </div>
                    <div className="text-center">
                      <div className="w-8 h-8 bg-purple-200 rounded-full flex items-center justify-center mb-1">★</div>
                      <span className="text-purple-600">{collectedCards.filter(c => c.rarity === 'epic').length}</span>
                    </div>
                    <div className="text-center">
                      <div className="w-8 h-8 bg-orange-200 rounded-full flex items-center justify-center mb-1">♦</div>
                      <span className="text-orange-600">{collectedCards.filter(c => c.rarity === 'legendary').length}</span>
                    </div>
                  </div>
                </div>
                
                <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
                  {collectedCards.map((card, index) => (
                    <Card 
                      key={index}
                      {...card}
                      onClick={() => card.utility && useCard(card)}
                    />
                  ))}
                </div>
                
                {collectedCards.length === 0 && (
                  <div className="text-center py-16">
                    <div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                      <span className="text-4xl text-gray-400">🎴</span>
                    </div>
                    <h3 className="text-lg font-semibold text-gray-700 mb-2">No cards yet!</h3>
                    <p className="text-gray-500 text-sm max-w-sm mx-auto">
                      Complete quizzes to collect your first cards and start building your collection!
                    </p>
                  </div>
                )}
                
                <div className="pt-6 border-t border-gray-200">
                  <button
                    onClick={() => setCurrentView('dashboard')}
                    className="goodnotes-button-secondary"
                  >
                    ← Back to Dashboard
                  </button>
                </div>
              </div>
            );
            
          case 'ranking':
            return (
              <div className="space-y-6">
                <EnhancedRanking 
                  players={rankings}
                  currentPlayer={playerName}
                  leaderboardType={leaderboardType}
                  onChangeType={setLeaderboardType}
                />
                <button
                  onClick={() => setCurrentView('dashboard')}
                  className="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg"
                >
                  ← Back to Dashboard
                </button>
              </div>
            );
            
          case 'teaching':
            return (
              <div className="bg-white rounded-2xl shadow-2xl p-6">
                <h2 className="text-2xl font-bold mb-4">🎓 Teaching Mode</h2>
                <p className="text-gray-600 mb-6">Choose a topic to teach your AI student!</p>
                
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                  {Object.keys(ENHANCED_QUESTION_BANKS).map(subject => (
                    <button
                      key={subject}
                      onClick={() => {
                        speak(`Great! Please teach me about ${subject}. Start with something basic and I'll ask questions!`);
                        setAvatarMood('curious');
                      }}
                      className="bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 rounded-lg hover:scale-105 transform transition-all"
                    >
                      <div className="text-2xl mb-2">
                        {subject === 'math' && '🔢'}
                        {subject === 'science' && '🔬'}
                        {subject === 'english' && '📚'}
                      </div>
                      <div className="font-semibold capitalize">{subject}</div>
                    </button>
                  ))}
                </div>
                
                <div className="bg-blue-50 p-4 rounded-lg mb-4">
                  <h3 className="font-semibold text-blue-800 mb-2">How Teaching Mode Works:</h3>
                  <ul className="text-blue-700 text-sm space-y-1">
                    <li>• Choose a subject you want to teach</li>
                    <li>• Explain concepts in your own words</li>
                    <li>• Your AI student will ask questions</li>
                    <li>• Answer questions to reinforce learning</li>
                    <li>• Earn bonus gems for teaching sessions!</li>
                  </ul>
                </div>
                
                <button
                  onClick={() => setCurrentView('dashboard')}
                  className="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg"
                >
                  ← Back to Dashboard
                </button>
              </div>
            );
            
          default:
            return (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {/* Quiz Cards - GoodNotes Style */}
                {Object.keys(ENHANCED_QUESTION_BANKS).map(subject => (
                  <div 
                    key={subject} 
                    className="goodnotes-card p-6 cursor-pointer group" 
                    onClick={() => startQuiz(subject)}
                  >
                    <div className="text-center">
                      <div className="w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center"
                           style={{
                             background: subject === 'math' ? 'linear-gradient(135deg, #007AFF 0%, #0056CC 100%)' :
                                        subject === 'science' ? 'linear-gradient(135deg, #34C759 0%, #28A745 100%)' :
                                        'linear-gradient(135deg, #AF52DE 0%, #8E44AD 100%)'
                           }}>
                        <Icon 
                          name={subject === 'math' ? 'calculator' : subject === 'science' ? 'flask-conical' : 'book-open'} 
                          size={24} 
                          color="white" 
                        />
                      </div>
                      <h3 className="text-xl font-semibold text-gray-800 mb-2 capitalize">{subject} Adventure</h3>
                      <p className="text-gray-600 text-sm mb-4 leading-relaxed">
                        Test your {subject} knowledge and collect amazing cards!
                      </p>
                      <div className="goodnotes-button w-full group-hover:scale-105 transition-transform">
                        Start Quiz →
                      </div>
                    </div>
                  </div>
                ))}
                
                {/* Feature Cards - GoodNotes Style */}
                <div className="goodnotes-card p-6 cursor-pointer group" onClick={() => setCurrentView('cards')}>
                  <div className="text-center">
                    <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center">
                      <Icon name="layers" size={24} color="white" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-800 mb-2">Card Collection</h3>
                    <p className="text-gray-600 text-sm mb-4 leading-relaxed">
                      View and manage your collected cards
                    </p>
                    <div className="goodnotes-button w-full group-hover:scale-105 transition-transform"
                         style={{ background: 'linear-gradient(135deg, #AF52DE 0%, #FF2D92 100%)' }}>
                      View Cards →
                    </div>
                  </div>
                </div>
                
                <div className="goodnotes-card p-6 cursor-pointer group" onClick={() => setCurrentView('ranking')}>
                  <div className="text-center">
                    <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl flex items-center justify-center">
                      <Icon name="trophy" size={24} color="white" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-800 mb-2">Leaderboards</h3>
                    <p className="text-gray-600 text-sm mb-4 leading-relaxed">
                      See how you rank against other learners
                    </p>
                    <div className="goodnotes-button w-full group-hover:scale-105 transition-transform"
                         style={{ background: 'linear-gradient(135deg, #FF9500 0%, #E67E22 100%)' }}>
                      View Rankings →
                    </div>
                  </div>
                </div>
                
                <div className="goodnotes-card p-6 cursor-pointer group" onClick={startTeachingMode}>
                  <div className="text-center">
                    <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-400 to-teal-500 rounded-2xl flex items-center justify-center">
                      <Icon name="graduation-cap" size={24} color="white" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-800 mb-2">Teaching Mode</h3>
                    <p className="text-gray-600 text-sm mb-4 leading-relaxed">
                      Teach others and reinforce your learning
                    </p>
                    <div className="goodnotes-button w-full group-hover:scale-105 transition-transform"
                         style={{ background: 'linear-gradient(135deg, #34C759 0%, #20B2AA 100%)' }}>
                      Start Teaching →
                    </div>
                  </div>
                </div>
              </div>
            );
        }
      };
      return (
        <div className="min-h-screen" style={{ background: 'linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%)' }}>
          {/* GoodNotes 6 Style Header */}
          <div className="sticky top-0 z-40 bg-white border-b border-gray-200 shadow-sm">
            <div className="max-w-7xl mx-auto px-6 py-4">
              <div className="flex justify-between items-center">
                <div className="flex items-center space-x-4">
                  <h1 className="text-2xl font-bold text-gray-800">ANKID</h1>
                  <div className="hidden md:flex space-x-6 text-sm">
                    <button 
                      onClick={() => setCurrentView('dashboard')}
                      className={`font-medium transition-colors ${currentView === 'dashboard' ? 'text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                    >
                      Dashboard
                    </button>
                    <button 
                      onClick={() => setCurrentView('cards')}
                      className={`font-medium transition-colors ${currentView === 'cards' ? 'text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                    >
                      Collection
                    </button>
                    <button 
                      onClick={() => setCurrentView('ranking')}
                      className={`font-medium transition-colors ${currentView === 'ranking' ? 'text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                    >
                      Leaderboard
                    </button>
                  </div>
                </div>
                
                <div className="flex items-center space-x-3">
                  <button
                    onClick={() => setShowQuests(true)}
                    className="tooltip relative bg-orange-100 text-orange-600 p-2 rounded-lg hover:bg-orange-200 transition-colors"
                    data-tooltip="Active Quests"
                  >
                    <Icon name="swords" size={20} />
                    {activeQuests.length > 0 && (
                      <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                        {activeQuests.length}
                      </span>
                    )}
                  </button>
                  <button
                    onClick={() => setShowSettings(true)}
                    className="tooltip bg-gray-100 text-gray-600 p-2 rounded-lg hover:bg-gray-200 transition-colors"
                    data-tooltip="Settings"
                  >
                    <Icon name="settings" size={20} />
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div className="max-w-7xl mx-auto px-6 py-8">
            {/* Player Stats Card - GoodNotes Style */}
            <div className="goodnotes-card p-6 mb-8 paper-texture">
              <div className="flex justify-between items-center">
                <div>
                  <h2 className="text-xl font-semibold text-gray-800 mb-1">Welcome back, {playerName}! 👋</h2>
                  <p className="text-gray-600 text-sm">Level {Math.floor(gems / 100) + 1} • Keep up the great work!</p>
                  {activeQuests.length > 0 && (
                    <div className="mt-2 inline-flex items-center bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-medium">
                      ⚔️ {activeQuests.length} active quest{activeQuests.length !== 1 ? 's' : ''}
                    </div>
                  )}
                </div>
                <div className="flex space-x-8">
                  <div className="text-center">
                    <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-2">
                      <Icon name="gem" size={24} color="#3B82F6" />
                    </div>
                    <div className="font-bold text-blue-600 text-lg">{gems}</div>
                    <div className="text-xs text-gray-500 font-medium">Gems</div>
                  </div>
                  <div className="text-center">
                    <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-2">
                      <Icon name="layers" size={24} color="#8B5CF6" />
                    </div>
                    <div className="font-bold text-purple-600 text-lg">{collectedCards.length}</div>
                    <div className="text-xs text-gray-500 font-medium">Cards</div>
                  </div>
                  <div className="text-center">
                    <div className="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-2">
                      <Icon name="flame" size={24} color="#F97316" />
                    </div>
                    <div className="font-bold text-orange-600 text-lg">{streak}</div>
                    <div className="text-xs text-gray-500 font-medium">Streak</div>
                  </div>
                  <div className="text-center">
                    <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-2">
                      <Icon name="graduation-cap" size={24} color="#10B981" />
                    </div>
                    <div className="font-bold text-green-600 text-lg">{teachingSessions}</div>
                    <div className="text-xs text-gray-500 font-medium">Teaching</div>
                  </div>
                </div>
              </div>
            </div>

            {/* Main Content Area */}
            {renderCurrentView()}
          </div>

          {/* Enhanced Learning Ambassador */}
          <LearningAmbassador 
            avatar={currentAvatar}
            isListening={isListening}
            onSpeak={() => speak(`Hi! I'm ${currentAvatar.name}, your ${currentAvatar.personality} learning companion! I'm excited to help you on your learning adventure!`)}
            onCustomize={() => setShowAvatarCustomizer(true)}
            currentQuest={activeQuests[0]}
            mood={avatarMood}
          />

          {/* Modal Components */}
          {showSettings && (
            <SettingsPanel 
              settings={settings}
              onUpdateSettings={setSettings}
              onClose={() => setShowSettings(false)}
            />
          )}

          {showAvatarCustomizer && (
            <AvatarCustomizer
              currentAvatar={currentAvatar}
              cosmetics={ownedCosmetics}
              onUpdateAvatar={setCurrentAvatar}
              onClose={() => setShowAvatarCustomizer(false)}
            />
          )}

          {showQuests && (
            <QuestPanel
              quests={activeQuests}
              onClose={() => setShowQuests(false)}
              onCompleteQuest={(questId) => {
                setCompletedQuests(prev => [...prev, questId]);
                setActiveQuests(prev => prev.filter(q => q.id !== questId));
              }}
            />
          )}
        </div>
      );
    };

    ReactDOM.render(<AnkidAdvancedApp />, document.getElementById("root"));
  </script>
  <script>
    // Error handling
    setTimeout(() => {
      if (typeof React === 'undefined') {
        document.getElementById("root").innerHTML = `
          <div style="padding: 20px; text-align: center; color: red; font-family: Arial, sans-serif;">
            <h2>Error: Dependencies failed to load</h2>
            <p>Please check your internet connection or try the simple version: 
            <a href="ankid-simple.html" style="color: blue;">ankid-simple.html</a></p>
          </div>
        `;
      }
    }, 3000);
  </script>
</body>
</html>
